<?xml version="1.0"?>
<Profiles xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Lua><![CDATA[
ABILITY_TABLE = { };
EVENT_MODS    = { };
COMBATLOG_MODS= { };
LAST_TARGET   = 0;

-- Константы горячих клавиш
mkLeftShift     = 1;
mkLeftControl   = 2;
mkLeftAlt       = 3;
mkRightShift    = 4;
mkRightControl  = 5;
mkRightAlt      = 6;

-- Ауры, которые позволяют произносить заклинания на ходу
moving_spell_table = {
    97128,  -- Опаляющее перо (Алисразор)
    79206,  -- Благосклонность предков (Шанам)
    108839, -- Плавучая льдина
    165803, -- Награнд (талбук)
    172106, -- Дух лисы (Охотник)
};

SetPOIIconOverlapDistance(12.00);
EVENT_MODS.MODIFIER_STATE_CHANGED = nil;

-- Возвращает, есть ли один из перечисленных бафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень бафов
--  filter - фильтр
function HasBuff(unit, spellId, filter)
    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitBuff(unit, spellName, spellRank, filter);
            if name then
                local rem = min(max((expires or 0) - (GetTime() - (AddonFrame.ping or 0)), 0), 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, nil, 0, 0;
end

-- Возвращает, есть ли один из перечисленных дебафов на персонаже
-- Возвращает:
--  Имя эффекта
--  Количество стаков
--  Оставшееся время действия
--  value1, value2, value3 - Величина эффекта
-- Параметры:
--  unit - Цель ("palyer", "target", "focus", "mouseover")
--  {...} - перечень дебафов
--  filter - фильтр
function HasDebuff(unit, spellId, filter)
    local spell_table = { };
    if type(spellId) == "table" then
        spell_table = spellId;
    elseif type(spellId) == "number" then
        spell_table = { spellId };
    end

    for _,spell_id in ipairs(spell_table) do
        local spellName, spellRank = GetSpellInfo(spell_id);
        if spellName then
            -- name, rank, icon, count, dispelType, duration, expires, caster, isStealable, shouldConsolidate, spellID, canApplyAura, isBossDebuff, value1, value2, value3
            local name,_,_,count,_,_,expires,_,_,_,_,_,_,value1,value2,value3 = UnitDebuff(unit, spellName, spellRank, filter);
            if name then
                local rem = min(max((expires or 0) - (GetTime() - (AddonFrame.ping or 0)), 0), 0xffff);
                return name, count, rem, value1, value2, value3;
            end
        end
    end
    return nil, 0, 0, nil, 0, 0;
end

-- Вызвращает время до восстановления заклинания
-- Параметр: ид заклинания
function SpellCD(m_spell)
    local start, duration, enable = GetSpellCooldown(m_spell);
    local cooldown = duration + start - GetTime();
    return (cooldown > 0 and cooldown - (AddonFrame.ping or 0) or 0), enable;
end

-- Проверка, двигается ли игрок, за исключением бафов, которые дают возможность кастровать на ходу
-- на пример: Опаляющее перо (Алисразор), Благосклонность предков (Шанам)
function IsMoving()
    for _, spell in ipairs(moving_spell_table) do
        local name,rank = GetSpellInfo(spell);
        if name and UnitAura("player", name, rank, nil) then
            return;
        end
    end
    return GetUnitSpeed("player") ~= 0 or IsFalling();
end

-- возвращает текущее значение здоровья в процентах
function HealthByPercent(m_target)
    return UnitExists(m_target) and 100 * (UnitHealth(m_target) or 1) / (UnitHealthMax(m_target) or 1) or 0;
end

-- возвращает текущее значение ресурса (мана, энергия, фокус, ярость ...) в процентах
function PowerByPercent(m_target, m_powertype)
    return UnitExists(m_target) and 100 * (UnitPower(m_target, m_powertype) or 1) / (UnitPowerMax(m_target, m_powertype) or 1) or 0;
end

-- Проверка, была ли зажата клавиша модификатор mk*
function IsModKeyDown(m_key)
    if not GetCurrentKeyBoardFocus() then
        return  (m_key == mkLeftShift    and IsLeftShiftKeyDown()   ) or
                (m_key == mkLeftControl  and IsLeftControlKeyDown() ) or
                (m_key == mkLeftAlt      and IsLeftAltKeyDown()     ) or
                (m_key == mkRightShift   and IsRightShiftKeyDown()  ) or
                (m_key == mkRightAlt     and IsRightAltKeyDown()    ) or
                (m_key == mkRightControl and IsRightControlKeyDown());
    end
end

-- Возвращает дистанцию между двумя игроками
function GetDistance(unit1, unit2)
    local lvl, a1, b1, a2, b2 = GetCurrentMapDungeonLevel();
    if not (a1 and b1 and a2 and b2) then
        lvl, a1, y1, a2, y2 = GetCurrentMapZone();
    end
    if a1 and b1 and a2 and b2 then
        local x1, y1 = GetPlayerMapPosition(unit1);
        local x2, y2 = GetPlayerMapPosition(unit2);
        local dX = ((x1 - x2) * abs(a2 - a1)) ^ 2;
        local dY = ((y1 - y2) * abs(b2 - b1)) ^ 2;
        return sqrt(dX + dY);
    end
end

-- Использование предмета в инвентаре
-- Если предмет (перчатка, тринька, пояс и т.п) юзабелен и не имеет КД - имитируем клик правой кн. мыши.
function UseItemBySlot(slotId)
    local start, duration, enable = GetInventoryItemCooldown("player", slotId);
    if duration == 0 and enable == 1 then
        UseInventoryItem(slotId);
    end
end

-- Использование предмета в инвентаре по его ID
function UseItemById(itemId)
    local count = GetItemCount(itemId);
    if (count or 0) > 0 then
        local start,duration,enable = GetItemCooldown(itemId);
        if start == 0 and duration == 0 and enable then
            UseItemByName(itemId);
        end
    end
end

-- Возвращает ID юнита
function UnitId(unit)
    return tonumber((UnitGUID(unit) or ""):match("-(%d+)-%x+$"), 10);
end

-- Проверяет, надо ли сбивать заклинание текущему юниту.
function CheckInterrupt(unit, sec)
    -- чтение заклинания прерываем только перед окончанием каста.
    local name,_,_,_,startTime,endTime,isTrade,_,notInterruptible = UnitCastingInfo(unit);
    if name and not (notInterruptible or isTrade) then
        if (((endTime / 1000) - GetTime()) - AddonFrame.ping) <= (sec or 1) then
            return true;
        end
    end
    -- канальное заклинание прерываем сразу.
    local name,_,_,_,_,_,isTrade,notInterruptible = UnitChannelInfo(unit);
    if name and not (notInterruptible or isTrade) then
        return true;
    end
end

-- Проверяет наличие исступления.
function CheckEnrage(unit, ...)
    if UnitCanAttack("player", unit) then
        -- Исступление отображается как пустая строка
        local dispels = { "", ... };
        for i = 1, 40 do
            local name,_,_,_,dispelType = UnitBuff(unit, i);
            if not name then
                return;
            end
            for _, dispell in ipairs(dispels) do
                if dispelType == dispell then
                    return true;
                end
            end
        end
    end
end

PLAYER = {
    HP   = 0,
    Agro = 0,
    IsMoving  = false,
    IsMounted = false,

    Init = function(self)
        self.HP = 100 * (UnitHealth("player") or 1) / (UnitHealthMax("player") or 1) or 0;
        self.IsMoving = IsMoving("player");
        self.IsMounted= IsMounted() and not HasBuff("player", 165803);
        self.Agro     = UnitThreatSituation("player") or 0;

        if PLAYER.HP < 30 and UnitAffectingCombat("player") and not PLAYER.IsMounted then
            local _, durationH, enableH = GetItemCooldown(5512);   -- Камень здоровья
            local _, durationP, enableP = GetItemCooldown(109223); -- Лечебное снадобье
            if durationH == 0 and enableH and GetItemCount(5512) > 0 then
                UseItemById(5512);
            elseif durationP == 0 and enableP and GetItemCount(109223) > 0 then
                UseItemById(109223);
            end
        end
    end,
};

PartyLogic = {
    First   = { },
    members = { },
    HasTank = false,

    DISPELL_TABLE = {
        PRIEST   = { Poison = 0, Disease = 1, Curse = 0 },
        DRUID    = { Poison = 1, Disease = 0, Curse = 1 },
        PALADIN  = { Poison = 1, Disease = 1, Curse = 0 },
        MONK     = { Poison = 1, Disease = 1, Curse = 0 },
        SHAMAN   = { Poison = 0, Disease = 0, Curse = 1 },
        --MAGE     = { Poison = nil , Disease = nil , Curse = 1 },

        GetDispellType = function(self, dispelType)
            local disTypes = self[select(2, UnitClass("player"))];
            if disTypes then
                local role = select(6, GetSpecializationInfo(GetSpecialization()));
                return role == "HEALER" and dispelType == "Magic" or disTypes[dispelType] == 1;
            end
        end
    },

    -- в эту функцию добавляем логику по особому поведению в рейдах
    -- на пример, если есть какой-то дебаф, который надо выхиливать.
    CheckInstanseLogic = function(self, member)
        -- Осада Огриммара: Малкорок
        -- Отхил не проходит, надо настакивать щит под дебафом
        -- по этому просто занижаем реальное здоровье.
        if HasDebuff(member.Unit, 142861) then
            if HasDebuff(member.Unit, 142863) then -- красный
                member.HP = 50;
            elseif HasDebuff(member.Unit, 142864) then -- желтый
                member.HP = 80;
            elseif HasDebuff(member.Unit, 142865) then -- зеленый
                member.HP = 100;
            else -- без щита
                member.HP = min(member.HP, 50);
            end
        -- Верховный молот: Кодгар (Дебаф: Исторжение магии: Темная магия)
        -- Дебаф вешает щит поглощающий опреленное количество лечения (надо выхиливать)
        elseif HasDebuff(member.Unit, 162184) then
            member.HP = min(member.HP, 50);
        -- Верховный молот: Кодгар (Дебаф: Жгучая энергия)
        -- Цель получает на 35% меньше отхила - надо сейвить
        elseif HasDebuff(member.Unit, 161242) then
            member.HP = min(40, member.HP);
        -- Верховный молот: Кодгар (Дебаф: Нейтрализующий щит)
        -- На цели есть щит поглощающий урон от магии (это основной урон на боссе)
        elseif HasDebuff(member.Unit, 163134) then
            member.HP = 101;
        -- Престол гроз: Тортос (Кристальная оболочка)
        -- Надо настакивть щит поглощающий урон
        elseif HasDebuff(member.Unit, 137633) then
            -- нужно доработать условие
            if not HasDebuff(member.Unit, 140701) then
                member.HP = min(member.HP, 50);
            end
        -- Престол гроз: Наложницы блезнецы (Дебаф: Чудовище из кошмаров)
        -- Вешается на танка, хилить нельзя
        elseif HasDebuff(member.Unit, 137341) then
            member.DontHeal = true;
        end
    end,

    -- Формирует таблицу "members" которая содержит юнитов нуждающихся в лечении.
    -- при формировании происходят проверки: (доступность + рейдовая логика)
    -- сформированная таблица будет отсортирована по наименьшему здоровью.
    Init = function(self)
        -- Обнуляем все хиловские глобальные переменные.
        self.HasTank = false;
        self.members = { { Unit = "player", IsInMyParty = true } };

        local prefix = IsInRaid() and "raid" or "party";
        for index = 1, GetNumGroupMembers() do
            local unit = prefix..index;
            if UnitExists(unit)
                and not UnitIsCorpse(unit)
                and not UnitIsUnit("player", unit)
                and not UnitIsEnemy("player", unit)
                and not UnitIsDeadOrGhost(unit)
                and     UnitIsConnected(unit)
                and     UnitInRange(unit) then
                table.insert(self.members, { Unit = unit, IsInMyParty = true });
            end
        end

        -- Обновляем статы игроков из пати/рейда
        for index = #self.members, 1, -1 do
            local member = self.members[index];

            member.IsTank  = UnitGroupRolesAssigned(member.Unit) == "TANK";
            member.IsHeal  = UnitGroupRolesAssigned(member.Unit) == "HEAL";
            member.Agro    = UnitThreatSituation(member.Unit) or 0;

            local max_hp   = UnitHealthMax(member.Unit) or 0;
            local inc_hp   = UnitGetIncomingHeals(member.Unit) or 0;
            local inc_abs  = UnitGetTotalAbsorbs(member.Unit) or 0;
            local cur_hp   = UnitHealth(member.Unit) or 0;

            member.IncHeal = 100 * inc_hp  / max_hp;
            member.Absorb  = 100 * inc_abs / max_hp;
            member.HP      = 100 * (cur_hp + inc_hp) / max_hp;

            -- логика по особому поведению в рейдах (только для лекарей)
            if UnitGroupRolesAssigned("player") == "HEAL" then
                self:CheckInstanseLogic(member);
            end

            if member.IsTank then
                self.HasTank = true;
            end

            -- удаляем из талицы юнит, которого нельзя хилить
            if member.DontHeal then
                table.remove(self.members, index);
            end
        end
        -- сортируем таблицы по наименьшему количеству ХР
        if #self.members > 1 then
            table.sort(self.members, function(x, y) return x.HP < y.HP; end);
        elseif #self.members == 0 then
            -- Это надо для того, чтобы небыло ошибок при обращении к первому элементу
            -- Возможны ситуации что в таблице никого не останется, из-за рейдовой логики.
            self.members = {{ Unit = "none", Agro = 0, HP = 100, IncHeal = 0 }};
        end
        self.First = self.members[1];
    end,

    -- Возвращает количество учасников группы с указанным или ниже здоровьем.
    LowHP = function(self, hp)
        local count = 0;
        for _,member in ipairs(self.members) do
            if member.HP <= hp and not member.DontHeal then
                count = count + 1;
            end
        end
        return count;
    end,

    -- логика развеивания заклинаний, тут добавляем условия, которые запрещают развеивать дебафы
    DontDispell = function(self, debuffId, member)
        -- ша гордыни: диспелим "Слово тьмы: Погибель" только с дебафом "Дар титанов"
        -- После "Освобождения" Дар титанов больше не кидается, поэтому диспелим по КД
        if debuffId == 144351 then
            if not HasDebuff("player", 144359) and HealthByPercent("boss1") > 30 then
                -- Если на нас много порчи - не диспелим
                if UnitPower("player", SPELL_POWER_ALTERNATE_POWER) > 50 then
                    return true;
                end
            end
        -- Глубиний
        elseif debuffId == 143579 then
            if select(2, HasDebuff(member.Unit, 143579)) < 3 then
                return true;
            end
        end
    end,

    -- Возвращает юнита, с которого надо диспелить (с наибольшим количеством стаков)
    -- Возвращает: unit, count или nil - если диспелить нечего.
    GetDispellInfo = function(self, unit)
        local dispellTable = { };
        for _,member in ipairs(self.members) do
            if not unit or UnitIsUnit(unit, member.Unit) then
                for index = 1, 40 do
                    local name,_,_,count,dispelType,_,_,_,_,_,debuffId = UnitDebuff(member.Unit, index);
                    if not name then break end
                    if self.DISPELL_TABLE:GetDispellType(dispelType) and not self:DontDispell(debuffId, member) then
                        table.insert(dispellTable, { Unit = member.Unit, Count = count, HP = member.HP });
                    end
                end
            end
        end

        if #dispellTable > 0 then
            table.sort(dispellTable, function(a, b) return a.Count > b.Count; end);
            return dispellTable[1].Unit, dispellTable;
        end
    end,
};

---------------------------------------
--              CORE                 --
---------------------------------------
function CheckKnownAbility(ability)
    ability.SpellName = GetSpellInfo(ability.SpellId);
    ability.IsKnown = false;

    if not ability.SpellName then
        print("|cff15bd05Ability: "..ability.Name..", invalid spell id ", ability.SpellId.."|r")
        return;
    end

    -- Основная проверка
    if IsPlayerSpell(ability.SpellId)
        or IsSpellKnown(ability.SpellId) or IsSpellKnown(ability.SpellId, true)
        or IsTalentSpell(ability.SpellName) then
        ability.IsKnown = true;
        return;
    end

    local spec = GetSpecialization();
    if spec then
        -- Проверка на доступность заклинания по уровню и специализиции
        local spellList = { GetSpecializationSpells(spec) };
        local lvl = UnitLevel("player");
        for i = 1, #spellList, 2 do
            if spellList[i] == ability.SpellId and lvl > (spellList[i+1] or 0) then
                ability.IsKnown = true;
                return;
            end
        end
    end

    -- Есть заклинания, которые имеют одинаковое название и разные Id
    local spellId = select(2, GetSpellBookItemInfo(ability.SpellName));
    if spellId and ability.SpellId ~= spellId then
        print(string.format("|cff15bd05Заклинание: %s Id %d -> %d|r", ability.SpellName, ability.SpellId, spellId));
        ability.SpellId = spellId;
        ability.IsKnown = true;
    end
end

-- Проверяем доступность заклинаний
function CheckAllSpells()
    if type(ABILITY_TABLE) == "table" then
        for _,ability in ipairs(ABILITY_TABLE) do
            if ability.SpellId > 0 then
                CheckKnownAbility(ability);
            end
        end
    end
end

function CheckAndCastAbility(ability, targetInfo)
    if ability.IsCheckInCombat and not UnitAffectingCombat("player") then
        return;
    end

    if ability.RecastDelay > 0
        and targetInfo.Guid == UnitGUID(targetInfo.Target)
        and ((targetInfo.LastCastingTime or 0) + ability.RecastDelay) >= GetTime() then
        return;
    end

    local spellName = GetSpellInfo(ability.SpellId);
    if not spellName and ability.SpellId > 0 then
        return;
    end

    if ability.SpellId < 1 then
        return ability.Func(ability, targetInfo, targetInfo.Target);
    elseif not ability.IsKnown then
        return;
    elseif ability.IsUsableCheck and not IsUsableSpell(spellName) then
        return;
    end

    local start, duration = GetSpellCooldown(ability.SpellId);
    if (duration + start - GetTime()) > AddonFrame.ping then
        return;
    end

    local castPing = AddonFrame.ping * 1000;
    if not ability.CancelCasting then
        local endTime = select(6, UnitCastingInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end

    if not ability.DropChanel then
        local endTime = select(6, UnitChannelInfo("player")) or 0;
        if (endTime - (GetTime() * 1000)) >= castPing then
            return;
        end
    end

    if (ability.IsMovingCheck == "notmoving"  and PLAYER.IsMoving)
    or (ability.IsMovingCheck == "moving" and not PLAYER.IsMoving) then
        return;
    end

    local result = ability.Func(ability, targetInfo, targetInfo.Target);
    if not result then
        return;
    elseif type(result) == "string" then
        targetInfo.Target = result;
    end

    if targetInfo.Target ~= "none" and targetInfo.Target ~= "player" and targetInfo.Target ~= "mouselocation" then
        if not UnitExists(targetInfo.Target) then
            return;
        elseif SpellHasRange(spellName) and IsSpellInRange(spellName, targetInfo.Target) == 0 then
        --elseif InRange(ability, targetInfo.Target) == 0 then
            return;
        elseif IsHelpfulSpell(spellName) and not UnitIsFriend("player", targetInfo.Target) then
            return;
        elseif IsHarmfulSpell(spellName) and UnitIsFriend("player", targetInfo.Target) then
            return;
        elseif not UnitIsFriend("player", targetInfo.Target) then
            if UnitIsDeadOrGhost(targetInfo.Target) or not UnitCanAttack("player", targetInfo.Target) then
                return;
            end
        end
    end

    if ability.CancelCasting then
        SpellStopCasting();
    end

    targetInfo.Guid = UnitGUID(targetInfo.Target);
    targetInfo.LastCastingTime = GetTime() + (select(7, GetSpellInfo(ability.SpellId)) or 0) / 1000;

    if targetInfo.Target == "mouselocation" then
        CastSpellByName(spellName, nil);
        CameraOrSelectOrMoveStart();
        CameraOrSelectOrMoveStop();
        CastSpellByName(spellName, nil);
    elseif targetInfo.Target == "none" then
        LAST_TARGET = UnitGUID("player");
        CastSpellByName(spellName, nil);
    else
        LAST_TARGET = UnitGUID(targetInfo.Target);
        CastSpellByName(spellName, targetInfo.Target);
    end
    return true;
end

function SetTargetCastintInfo(spellId, guid, castTime)
    local dstGuid = guid and guid or LAST_TARGET;
    for _,ability in ipairs(ABILITY_TABLE) do
        for _,targetInfo in ipairs(ability.TargetList) do
            if spellId == ability.SpellId and UnitGUID(targetInfo.Target) == dstGuid then
                targetInfo.Guid = guid;
                targetInfo.LastCastingTime = castTime;
            end
        end
    end
end

function AddonFrame_OnEvent(self, event, ...)
    if event == "PLAYER_ENTERING_WORLD" then
        self:Show();
        CheckAllSpells();
    elseif event == "PLAYER_LOGOUT" then
        ChangeRotation();
    elseif event == "SPELLS_CHANGED" then
        CheckAllSpells();
    elseif event == "COMBAT_LOG_EVENT_UNFILTERED" then
        local _,subEvent,_,sourceGUID,_,_,_,destGUID,_,_,_,spellId = ...;
        if subEvent == "SPELL_CAST_SUCCESS" and sourceGUID == UnitGUID("player") then
            SetTargetCastintInfo(spellId, destGUID, GetTime());
        elseif subEvent == "SPELL_CAST_FAILED" and sourceGUID == UnitGUID("player") then
            SetTargetCastintInfo(spellId, nil, 0);
        end

        if COMBATLOG_MODS[subEvent] then
            COMBATLOG_MODS[subEvent](...);
        end
    end

    if EVENT_MODS[event] then
        EVENT_MODS[event](...);
    end
end

-- Устанавливает доступность цели из шаблонного списка
function SetTargetListState(state, targetPattern)
    targetPattern = targetPattern or "boss%d";
    for _, ability in ipairs(ABILITY_TABLE) do
        for _, targetInfo in ipairs(ability.TargetList) do
            if string.find(targetInfo.Target, targetPattern) then
                -- Делаем наоборот, совместимость с клиенской частью
                targetInfo.IsDisable = not state;
            end
        end
    end
end

function AddonFrame_AbilityLoop()
    for _,ability in ipairs(ABILITY_TABLE) do
        if not ability.Failed then
            local targetList = ability.TargetList or { "none" };
            for _,targetInfo in ipairs(targetList) do
                if not targetInfo.IsDisable then
                    if CheckAndCastAbility(ability, targetInfo) then
                        return;
                    end
                end
            end
        end
    end
end

function AddonFrame_OnUpdate(self, elapsed)
    if type(ABILITY_TABLE) == "table" and GetTime() >= (AddonFrame.LastTime or 0) then
        if AddonFrame.CurentRotation and not UnitIsDeadOrGhost("player") and not UnitIsAFK("player") then
            AddonFrame.ping = select(4, GetNetStats()) / 1000;
            PLAYER:Init();
            PartyLogic:Init();
            AddonFrame_AbilityLoop();
        end
        AddonFrame.LastTime = GetTime() + math.random(150, 250) / 1000;
    end
    if (AddonFrame.Duration or 0) < GetTime() then
        AddonFrame.Msg:SetText("");
    end
end

if type(AddonFrame) == "table" then
    AddonFrame:UnregisterAllEvents();
end

if type(AddonFrame) ~= "table" then
    AddonFrame = CreateFrame("Frame");
    AddonFrame:SetScript("OnUpdate", AddonFrame_OnUpdate);
    AddonFrame:SetScript("OnEvent",  AddonFrame_OnEvent);
    AddonFrame:SetHeight(300);
    AddonFrame:SetWidth(600);
    AddonFrame.Buttons = {};
    AddonFrame.Msg = AddonFrame:CreateFontString(nil, "BACKGROUND", "PVPInfoTextFont");
    AddonFrame.Msg:SetAllPoints();
    AddonFrame.print = function(msg, con)
        AddonFrame.Msg:SetText(msg);
        if con then print(msg) end
        AddonFrame.Duration = GetTime() + 5;
    end;
    AddonFrame:SetPoint("CENTER", 0, 200);
    AddonFrame:Show();
end

function ChangeRotation(rotation)
    if AddonFrame then
        if AddonFrame.CurentRotation and (not rotation or rotation == AddonFrame.CurentRotation) then
            AddonFrame.CurentRotation = nil;
            AddonFrame:UnregisterAllEvents();
            AddonFrame.print("|cfff5360cРотация отключена.|r", true);
            PlaySound("PAPERDOLLCLOSE", "Master");
            SetPOIIconOverlapDistance(12.00);
        elseif rotation then
            AddonFrame:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED");
            AddonFrame:RegisterEvent("PLAYER_ENTERING_WORLD");
            AddonFrame:RegisterEvent("PLAYER_LOGOUT");
            AddonFrame:RegisterEvent("WORLD_MAP_UPDATE");
            AddonFrame:RegisterEvent("MODIFIER_STATE_CHANGED");
            AddonFrame:RegisterEvent("SPELLS_CHANGED");
            AddonFrame.CurentRotation = rotation;
            AddonFrame.print("|cff15bd05Ротация: |r|cff6f0a9a"..rotation.."|r|cff15bd05 - Включена.|r", true);
            PlaySound("PAPERDOLLOPEN", "Master");
            CheckAllSpells();
        end
    end;
end
]]></Lua>
  <Profile Class="Warrior">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isAltMod    = nil;

SPELL_REFLECT_TABLE = {
    list = {
        -- PVP
        GetSpellInfo(33786),  -- DRUID   (Смерч)
        GetSpellInfo(28272),  -- MAGE    (Превращение - Свинья)
        GetSpellInfo(118),    -- MAGE    (Превращение - Овца)
        GetSpellInfo(61305),  -- MAGE    (Превращение - Кошка)
        GetSpellInfo(61721),  -- MAGE    (Превращение - Кролик)
        GetSpellInfo(61780),  -- MAGE    (Превращение - Индейка)
        GetSpellInfo(28271),  -- MAGE    (Превращение - Черепаха)
        GetSpellInfo(113092), -- MAGE    (Ледяная бомба)
        GetSpellInfo(30451),  -- MAGE    (Чародейская вспышка)
        GetSpellInfo(20066),  -- PALADIN (Покаяние)
        GetSpellInfo(605),    -- PRIEST  (Господство над разумом)
        GetSpellInfo(51514),  -- SHAMAN  (Сглаз)
        GetSpellInfo(51505),  -- SHAMAN  (Выброс лавы)
        GetSpellInfo(5782),   -- WARLOCK (Страх)
        GetSpellInfo(118699), -- WARLOCK (Страх)
        GetSpellInfo(116858), -- WARLOCK (Стрела Хаоса)
        -- PVE
        GetSpellInfo(144214), -- Стрела ледяной бури (Кор'кронские Тёмные Шаманы)
    },

    NeedReflect = function(self, unitEnemy)
        if UnitIsEnemy("player", unitEnemy) and UnitIsUnit("player", unitEnemy.."target") then
            local name,_,_,_,_,endTime = UnitCastingInfo(unitEnemy);
            if name and (((endTime / 1000) - GetTime()) - AddonFrame.ping) < 2 then
                for _, spell in ipairs(self.list) do
                    if name == spell then
                        return true;
                    end
                end
            end
        end
    end
};

function IsLossOfControl()
    --[[
    STUN_MECHANIC
    SCHOOL_INTERRUPT
    DISARM
    PACIFYSILENCE
    SILENCE
    ROOT
    PACIFY
    STUN
    FEAR
    CHARM
    CONFUSE
    POSSESS
    ]]
    local list = { 'FEAR',  'PACIFY', 'CHARM', 'CONFUSE', 'POSSESS' };
    local locType = C_LossOfControl.GetEventInfo(1);
    if locType then
        for _, t in ipairs(list) do
            if t == locType then
                return true;
            end
        end
    end
end
]]></Lua>
    <Rotation Name="Защита" Spec="Warrior_Protection">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
isAltMod = true;
useInterrupt = true;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RALT" then
        if isAltMod then
            isAltMod = false;
            AddonFrame.print("|cffff0000Используется блок щитом", true);
        else
            isAltMod = true;
            AddonFrame.print("|cff00ff00Используется непроницаемый щит", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end

--AddonFrame.StateButtons:AddButton(
--    "Режим АОЕ",
--    "Включает\\Выключает режим АОЕ",
--    "Icons\ttt",
--    mkLeftShift,
--    function(bstate)
--        setAoE = bstate;
--    end
--);
]]></Lua>
      <Ability Name="Героический прыжок">
        <SpellID>6544</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Опустошитель">
        <SpellID>152277</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(23922), "target") == 1;-- and UnitIsEnemy("target", "player");
]]></Lua>
      </Ability>
      <Ability Name="Отражение заклинания">
        <SpellID>23920</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Код профиля
return SPELL_REFLECT_TABLE:NeedReflect(target);
]]></Lua>
      </Ability>
      <Ability Name="Зуботычина">
        <SpellID>6552</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Победный раж">
        <SpellID>34428</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP <= 80 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ярость берсерка">
        <SpellID>18499</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsLossOfControl();
]]></Lua>
      </Ability>
      <Ability Name="Сосредоточенная ярость">
        <SpellID>204488</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and not HasBuff("player", 202574) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Стойкость к боли">
        <SpellID>190456</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and PLAYER.Agro > 2 and UnitPower("player") > 30 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Блок щитом">
        <SpellID>2565</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- 132404 Блок щитом
if PLAYER.Agro > 2 and not HasBuff("player", 132404) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Глухая оборона">
        <SpellID>871</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 30 and PLAYER.Agro > 2 and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ни шагу назад">
        <SpellID>12975</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 20 and PLAYER.Agro > 2 and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Деморализующий крик">
        <SpellID>1160</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP <= 50 and isInMeele and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар грома">
        <SpellID>6343</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and setAoE then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Мощный удар щитом">
        <SpellID>23922</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Реванш">
        <SpellID>6572</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- дает 20 ярости
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Сокрушение">
        <SpellID>20243</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Героический бросок">
        <SpellID>57755</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Неистовство" Spec="Warrior_Fury">
      <HotKey Key="V" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = 0;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        setAoE = setAoE or 0;
        if setAoE == 0 then
            setAoE = 1;
            AddonFrame.print("|cff6f0a9aКливы", true);
        elseif setAoE == 1 then
            setAoE = 2;
            AddonFrame.print("|cffff0000AOE", true);
        else
            setAoE = 0;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Героический прыжок">
        <SpellID>6544</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if type(setAoE) ~= "number" then
    setAoE = 0;
end

if IsMouseButtonDown(4) then
    for index = 1, NUM_WORLD_RAID_MARKERS do
        if not IsRaidMarkerActive(index) then
            PlaceRaidMarker(index);
            break;
        end
    end
    return true;
end

if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(5308), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Зуботычина">
        <SpellID>6552</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Ярость берсерка">
        <SpellID>18499</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsLossOfControl();
]]></Lua>
      </Ability>
      <Ability Name="Рев дракона">
        <SpellID>118000</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele and not HasBuff("player", 1719);
]]></Lua>
      </Ability>
      <Ability Name="Боевой крик">
        <SpellID>1719</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele then
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Кровавая баня">
        <SpellID>12292</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele then
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вихрь">
        <SpellID>190411</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local setAoE = setAoE or 0;
if isInMeele then
    if setAoE == 2 or HasBuff("player", 215570) then -- Пушечное ядро
        return true;
    elseif setAoE == 1 then
        return not HasBuff("player", 85739); -- Кровавый фарш
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Казнь">
        <SpellID>5308</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 184362) or UnitPower("player") > 80 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Яростный выпад">
        <SpellID>85288</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Буйство">
        <SpellID>184367</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasBuff("player", 184362)
    or UnitPower("player") >= UnitPowerMax("player")-1 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Кровожадность">
        <SpellID>23881</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasBuff("player", 184362) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар громовержца">
        <SpellID>107570</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Кровожадность">
        <SpellID>23881</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Неистовый удар с плеча">
        <SpellID>100130</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Героический бросок">
        <SpellID>57755</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Оружие" Spec="Warrior_Arms">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = 0;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        setAoE = setAoE or 0;
        if setAoE == 0 then
            setAoE = 1;
            AddonFrame.print("|cff6f0a9aКливы", true);
        elseif setAoE == 1 then
            setAoE = 2;
            AddonFrame.print("|cffff0000AOE", true);
        else
            setAoE = 0;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Героический прыжок">
        <SpellID>6544</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if type(setAoE) ~= "number" then
    setAoE = 0;
end

if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(772), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Победный раж">
        <SpellID>34428</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PLAYER.HP <= 80;
]]></Lua>
      </Ability>
      <Ability Name="Зуботычина">
        <SpellID>6552</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Ярость Берсерка">
        <SpellID>18499</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsLossOfControl();
]]></Lua>
      </Ability>
      <Ability Name="Боевой крик">
        <SpellID>1719</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele then
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Разсекающий удар">
        <SpellID>845</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and setAoE > 0 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вихрь">
        <SpellID>190411</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele and setAoE > 0;
]]></Lua>
      </Ability>
      <Ability Name="Кровопускание">
        <SpellID>772</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 772, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар колосса">
        <SpellID>167105</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff(target, 208086, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Казнь">
        <SpellID>5308</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Превоскходство">
        <SpellID>7384</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Смертельный удар">
        <SpellID>12294</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Мощный удар">
        <SpellID>1464</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return setAoE == 0;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Paladin">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
]]></Lua>
    <Rotation Name="Защита" Spec="Paladin_Protection">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    --if modifier == "LCTRL" then
    --    if setAoE then
    --        setAoE = false;
    --        AddonFrame.print("|cff00ff00Одиночная цель", true);
    --    else
    --        setAoE = true;
    --        AddonFrame.print("|cffff0000AOE", true);
    --    end
    --else
    if modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(96231), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Укор">
        <SpellID>96231</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Свет защитника">
        <SpellID>184092</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 70 and HasBuff("player", 188370) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Гнев карателя">
        <SpellID>31884</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ревностный защитник">
        <SpellID>31850</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 15 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Защитник древних королей">
        <SpellID>86659</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 40 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Очищение от токсинов">
        <SpellID>213644</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Щит праведника">
        <SpellID>53600</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.Agro > 2 and not HasBuff("player", 132403, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Щит мстителя">
        <SpellID>31935</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Правосудие">
        <SpellID>20271</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Молот праведника">
        <SpellID>53595</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Освящение">
        <SpellID>26573</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Искупление">
        <SpellID>7328</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Лекарь" Spec="Paladin_Holy">
      <HotKey Key="Z" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(96231), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Искупление">
        <SpellID>7328</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Воздаяние" Spec="Paladin_Retribution">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(35395), "target") == 1;
hollyPower = UnitPower("player", SPELL_POWER_HOLY_POWER);
]]></Lua>
      </Ability>
      <Ability Name="Укор">
        <SpellID>96231</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Очищение">
        <SpellID>4987</SpellID>
        <Target>Focus</Target>
        <Target>Player</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Вспышка света">
        <SpellID>19750</SpellID>
        <Target>Player</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Самоотверженный целитель (3 стака)
if HealthByPercent(target) < 80 and select(2, HasBuff("player", 114250)) > 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Гнев карателя">
        <SpellID>31884</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Святой каратель">
        <SpellID>105809</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and hollyPower <= 2 and isInMeele then
    -- Защитник древних королей
    if SpellCD(86698) < 289 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Правосудие">
        <SpellID>20271</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Божественная буря">
        <SpellID>53385</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return (isInMeele and ( (setAoE and hollyPower > 2) or HasBuff("player", 144595) ~= nil));
]]></Lua>
      </Ability>
      <Ability Name="Клинок справедливости">
        <SpellID>184575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return hollyPower < 4;
]]></Lua>
      </Ability>
      <Ability Name="Вердикт храмовника">
        <SpellID>85256</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return hollyPower > 4;
]]></Lua>
      </Ability>
      <Ability Name="Отмщение вершителя правосудия">
        <SpellID>215661</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if hollyPower > 4 or HasBuff("player", 223819) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар воина Света">
        <SpellID>35395</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Вердикт храмовника">
        <SpellID>85256</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not setAoE and hollyPower > 2;
]]></Lua>
      </Ability>
      <Ability Name="Искупление">
        <SpellID>7328</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Hunter">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isAltMod    = nil;

setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
    <Rotation Name="Выживание" Spec="Hunter_Survival">
      <HotKey Key="X" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or IsStealthed() then
    StopAttack();
    PetStopAttack();
    return true;
end

if HasBuff("player", 5384) then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(185855), "target") == 1;

if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
      </Ability>
      <Ability Name="Перенаправление">
        <SpellID>34477</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("focus") and UnitIsFriend("player", "focus") and not UnitIsDeadOrGhost("focus") then
        return "fucus";
    elseif UnitExists("mouseover") and UnitIsFriend("player", "mouseover") and not UnitIsDeadOrGhost("mouseover") then
        return "mouseover";
    elseif UnitExists("pet") and not UnitIsDeadOrGhost("pet") then
        return "pet";
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Встречный выстрел">
        <SpellID>147362</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Взрывная ловушка">
        <SpellID>191433</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Лечение питомца">
        <SpellID>136</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local pethp = HealthByPercent("pet");
if pethp ~= 0 and pethp < 75 then
    if not HasBuff("pet", 136) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Дух орла">
        <SpellID>186289</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Разделка туши">
        <SpellID>187708</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if setAoE and isInMeele then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Режущий удар">
        <SpellID>185855</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Укус мангуста">
        <SpellID>190928</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Обходной удар">
        <SpellID>202800</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Стрельба" Spec="Hunter_Marksmanship">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or IsStealthed() or PLAYER.IsMounted then
    StopAttack();
    PetStopAttack();
    return true;
end

if HasBuff("player", 5384) then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(19434), "target") == 1;

if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
      </Ability>
      <Ability Name="Рык">
        <SpellID>2649</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not select(2, GetSpellAutocast(GetSpellInfo(ability.SpellId), "pet")) then
    if not (UnitInRaid("player") or UnitInParty("player")) then
        if (UnitThreatSituation("pet", "target") or 0) < 2 then
            return true;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Перенаправление">
        <SpellID>34477</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("focus") and UnitIsFriend("player", "focus") and not UnitIsDeadOrGhost("focus") then
        return "fucus";
    elseif UnitExists("mouseover") and UnitIsFriend("player", "mouseover") and not UnitIsDeadOrGhost("mouseover") then
        return "mouseover";
    elseif UnitExists("pet") and not UnitIsDeadOrGhost("pet") then
        return "pet";
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Встречный выстрел">
        <SpellID>147362</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Лечение питомца">
        <SpellID>136</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local pethp = HealthByPercent("pet");
if pethp ~= 0 and pethp < 75 then
    if not HasBuff("pet", 136) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Шквал">
        <SpellID>120360</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Меткий выстрел">
        <SpellID>193526</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInRange then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Прицельный залп">
        <SpellID>185901</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Рогатые грумучие змеи">
        <SpellID>214579</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff("target", 187131, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Прицельный выстрел">
        <SpellID>19434</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Повелитель зверей" Spec="Hunter_Beastmaster">
      <HotKey Key="V" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or IsStealthed() then
    StopAttack();
    PetStopAttack();
    return true;
end

if HasBuff("player", 5384) then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(193455), "target") == 1;

if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
      </Ability>
      <Ability Name="Ледяная ловушка">
        <SpellID>13809</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkRightAlt);
]]></Lua>
      </Ability>
      <Ability Name="Триньки/перчатки">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- если персонаж на маунте, тогда не выполняем ротацию дальше
if PLAYER.IsMounted or IsStealthed() then
    return true;
end

if useCooldown then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end
]]></Lua>
      </Ability>
      <Ability Name="Перенаправление">
        <SpellID>34477</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("focus") and UnitIsFriend("player", "focus") and not UnitIsDeadOrGhost("focus") then
        return "fucus";
    elseif UnitExists("mouseover") and UnitIsFriend("player", "mouseover") and not UnitIsDeadOrGhost("mouseover") then
        return "mouseover";
    elseif UnitExists("pet") and not UnitIsDeadOrGhost("pet") then
        return "pet";
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Встречный выстрел">
        <SpellID>147362</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Лечение питомца">
        <SpellID>136</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local pethp = HealthByPercent("pet");
if pethp ~= 0 and pethp < 75 then
    if not HasBuff("pet", 136) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Звериный натиск">
        <SpellID>201430</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Звериный гнев">
        <SpellID>19574</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInRange and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Дух дикой природы">
        <SpellID>193530</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown and isInRange;
]]></Lua>
      </Ability>
      <Ability Name="Стая воронов">
        <SpellID>131894</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Залп">
        <SpellID>2643</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return setAoE;
]]></Lua>
      </Ability>
      <Ability Name="Команда Взять!">
        <SpellID>34026</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsSpellInRange(GetSpellInfo(2649), "target") == 1 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Выстрел химеры">
        <SpellID>53209</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Ужасный зверь">
        <SpellID>120679</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Шквал">
        <SpellID>120360</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Выстрел кобры">
        <SpellID>193455</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local focus = SpellCD(120360) < 3 and 60 or 40;
if UnitPower("player") >= focus then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Rogue">
    <Lua><![CDATA[
setAoE = false;
invisible = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RCTRL" then
        if invisible then
            invisible = false;
            AddonFrame.print("|cffff0000Незаметность выключена", true);
        else
            invisible = true;
            AddonFrame.print("|cff00ff00Незаметность включена", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
    <Rotation Name="Ликвидация" Spec="Rogue_Assassination">
      <HotKey Key="X" Modifier="Alt" />
      <Ability Name="Инициализаця">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted then
    return true;
end

max_cp = UnitPowerMax("player", SPELL_POWER_COMBO_POINTS);
isInMeele  = IsSpellInRange(GetSpellInfo(703), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Внезапный удар">
        <SpellID>8676</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetShapeshiftForm() == 1 and IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Веер клинков">
        <SpellID>51723</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) and GetShapeshiftForm() == 0 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вендетта">
        <SpellID>79140</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and IsSpellInRange(GetSpellInfo(1329), "target") == 1 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Рваная рана">
        <SpellID>1943</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", target) > 4 then
    if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 7 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Отравление">
        <SpellID>32645</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", target) > 4 then
    if select(3, HasDebuff(target, 1943, "PLAYER")) > 7 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Гаррота">
        <SpellID>703</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Кровоизлияние">
        <SpellID>16511</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 6 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Расправа">
        <SpellID>1329</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Отравленный нож">
        <SpellID>185565</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return UnitPower("player") > 55;
]]></Lua>
      </Ability>
      <Ability Name="Смертоносный яд">
        <SpellID>2823</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>3</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
local buffs = {
    2823,   -- Быстродействующий яд (старый)
    8679,   -- Нейтрализующий яд (ослабление исцеления)
    157584, -- Быстродействующий яд (перк)
};

if not HasBuff("player", buffs) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Похищающий  жизнь яд">
        <SpellID>108211</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>3</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
local buffs = {
    108211, -- Похищающий жизнь яд (лечение)
    3408,   -- Калечащий яд (замедление)
};

if not HasBuff("player", buffs) then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Скрытность" Spec="Rogue_Subtlety">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Инициализаця">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted then
    return true;
end

if not UnitAffectingCombat("player") and GetSpecialization() == 3  then
    if GetShapeshiftForm() ~= 1 then
        local start, duration, enable = GetShapeshiftFormCooldown(1);
        if enable == 1 and start == 0 then
            CastShapeshiftForm(1);
        end
    end
end

max_cp = UnitPowerMax("player", SPELL_POWER_COMBO_POINTS);
]]></Lua>
      </Ability>
      <Ability Name="Теневые клинки">
        <SpellID>121471</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Танец теней">
        <SpellID>185313</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and not HasBuff("player", 196976) then
    if select(3, HasBuff("player", 212283)) <= 10 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Символы смерти">
        <SpellID>212283</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- With active buff "Shadowdace"
if HasBuff("player", 185422) or GetShapeshiftForm() == 1 then
    if select(3, HasBuff("player", 212283)) <= 10 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Окутывающая тень">
        <SpellID>206237</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") >= max_cp then
    if select(3, HasBuff("player", 206237)) < 10 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Ночной клинок">
        <SpellID>195452</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") >= max_cp then
    if select(3, HasDebuff(target, 195452)) < 7 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Потрошение">
        <SpellID>196819</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") >= max_cp then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар тьмы">
        <SpellID>185438</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetShapeshiftForm() == 1 or HasBuff("player", 185422) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар в спину">
        <SpellID>53</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", target) <= max_cp then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Бросок сюрикена">
        <SpellID>114014</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Бой" Spec="Rogue_Combat">
      <HotKey Key="V" Modifier="Alt" />
      <Ability Name="Инициализаця">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted then
    return true;
end

max_cp = UnitPowerMax("player", SPELL_POWER_COMBO_POINTS);
isInMeele  = IsSpellInRange(GetSpellInfo(8676), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Выброс адреналина">
        <SpellID>13750</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele and useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Бросок костей">
        <SpellID>193316</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local buffs = {
    199603, -- Веселый роджер
    193358, -- Великая битва
    193357, -- Море акул
    193359, -- Истинный азимут
    199600, -- Зарытое сокровище
    193356, -- Бортовые залпы
};

if isInMeele and GetComboPoints("player", "target") >= max_cp then
    if select(3, HasBuff("player", buffs)) < 10 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Мясорубка">
        <SpellID>5171</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and GetComboPoints("player", "target") >= max_cp then
    if select(3, HasBuff("player", 5171)) < 10 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Смерть с небес">
        <SpellID>152150</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") >= max_cp then
    -- выброс адреналина
    if not HasBuff("player", 13750) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Промеж глаз">
        <SpellID>199804</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") >= max_cp then
    -- Море акул
    if HasBuff("player", 193357) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Круговая атака">
        <SpellID>2098</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", target) >= max_cp then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Внезапный удар">
        <SpellID>8676</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetShapeshiftForm() == 1 and IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Выстрел из пистоли">
        <SpellID>185763</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Замечательная возможность
if HasBuff("player", 195627) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар саблей">
        <SpellID>193315</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Выстрел из пистоли">
        <SpellID>185763</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Обшаривание карманов" Spec="None">
      <HotKey Key="U" Modifier="Alt" />
      <Lua><![CDATA[
mTempTable = { };
registerMsgIds = {
    50,  -- У этого существа нет карманов
    161, -- Нет добычи
    625, -- Вашу цель уже обокрали
};

AddonFrame:RegisterEvent("UI_ERROR_MESSAGE");
--AddonFrame:RegisterEvent("LOOT_OPENED");

function EVENT_MODS.UI_ERROR_MESSAGE(id, msg)
    --print(id, msg)
    for _, msgId in ipairs(registerMsgIds) do
        if msgId == id then
            mTempTable[LAST_TARGET] = GetTime();
            break;
        end
    end
end

function EVENT_MODS.WORLD_MAP_UPDATE()
    -- очистка таблицы мобов с обшареными карманами
    mTempTable = { };
end

-- Функция проверки на возможность обокрасть цель.
-- Проверяется таблица на присутствие "неправильного моба"
function IsPickPocketed(unit)
    if type(mTempTable) == "table" then
        local lastTime = mTempTable[UnitGUID(unit)] or 0;
        if (lastTime + 300) > GetTime() then
            return true;
        end
    end
end

function EVENT_MODS.LOOT_OPENED()
    for i = 1, GetNumLootItems() do
        --local texture, item, quantity = GetLootSlotInfo(i);
        --print(item, quantity);
        if quantity == 0 or item == GetItemInfo(16885) then
            LootSlot(i);
            --print("Looting: ", item);
        end
    end
end
]]></Lua>
      <Ability Name="Init">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.IsMounted or IsModKeyDown(mkLeftShift) then
    return true;
end

if GetShapeshiftForm() == 0 and GetShapeshiftFormCooldown(1) == 0 then
    CastShapeshiftForm(1);
end
]]></Lua>
      </Ability>
      <Ability Name="Ошеломление">
        <SpellID>6770</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff(target, 6770) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Обшаривание карманов">
        <SpellID>921</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitExists(target) then
    if not IsPickPocketed(target) and not UnitIsDeadOrGhost(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Priest">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
useAutoDispell = true;
]]></Lua>
    <Rotation Name="Послушание" Spec="Priest_Discipline">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
useAutoDispell = true;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "RALT" then
        if useAutoDispell then
            useAutoDispell = false;
            AddonFrame.print("|cffff0000Диспел по mouseover: Выключен", true);
        else
            useAutoDispell = true;
            AddonFrame.print("|cff00ff00Диспел по mouseover: Включен", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Божественное перышко">
        <SpellID>121536</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Массовое разсеивание">
        <SpellID>32375</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return IsMouseButtonDown(4);-- IsModKeyDown(mkLeftAlt);
]]></Lua>
      </Ability>
      <Ability Name="Слово силы: Барьер">
        <SpellID>62618</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsMouseButtonDown(3);-- IsModKeyDown(mkLeftControl);
]]></Lua>
      </Ability>
      <Ability Name="Левитация">
        <SpellID>1706</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not IsFalling() then
    falingStartTime = 0;
elseif IsFalling() and (falingStartTime or 0) == 0 then
    falingStartTime = GetTime();
elseif GetTime() - (falingStartTime or 0) > 1 and not HasBuff("player", 111759) then
    falingStartTime = 0;
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Разсеивание заклинаний (Авто)">
        <SpellID>527</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useAutoDispell then
    return PartyLogic:GetDispellInfo();
end
]]></Lua>
      </Ability>
      <Ability Name="Подавление боли">
        <SpellID>33206</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and PartyLogic.First.HP < 30 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Подчиняющий разум">
        <SpellID>123040</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsSpellInRange(GetSpellInfo(585), "target") == 1 then
    return myMana < 80;
end
]]></Lua>
      </Ability>
      <Ability Name="Придание сил">
        <SpellID>10060</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:LowHP(50) > 3;
]]></Lua>
      </Ability>
      <Ability Name="Слово силы: Щит">
        <SpellID>17</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Ослабленная душа (6788)
if IsModKeyDown(mkLeftControl)
and UnitExists("mouseover")
and UnitHealth("mouseover") > 100
and UnitIsFriend("player", "mouseover")
and not HasDebuff("mouseover", 6788) then
    return "mouseover";
end

if PLAYER.Agro > 0 and not HasDebuff("player", 6788) then
    return GetNumGroupMembers() == 0;
end

for _, member in ipairs(PartyLogic.members) do
    if (not HasDebuff(member.Unit, 6788) and not HasBuff(member.Unit, 17))
        or HasBuff("player", 123266) then
        if (member.IsTank and member.Agro > 2) or IsModKeyDown(mkLeftControl) then
            return member.Unit;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Быстрое исцеление">
        <SpellID>2061</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic.First.HP < 40 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Молитва восстановления">
        <SpellID>33076</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic:LowHP(90) > 2 and PartyLogic.First.HP < 85 then
   return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Молитва Исцеления">
        <SpellID>596</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
-- Если активен щит души, тогда настакиваем щит
if PartyLogic:LowHP(70) > 3 or HasBuff("player", 114908, "PLAYER") then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Великое исцеление">
        <SpellID>2060</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic.First.HP < 60 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Обновление">
        <SpellID>139</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
for _,member in ipairs(PartyLogic.members) do
   if member.IsTank and member.HP < 70 then
       if not HasBuff(member.Unit, 139, "PLAYER") then
           return member.Unit;
       end
   end
end
]]></Lua>
      </Ability>
      <Ability Name="Исповедь">
        <SpellID>47540</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitIsFriend("target", "player") then
    return "target";
elseif PartyLogic.First.HP < 60 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Слово тьмы: Утешение">
        <SpellID>129250</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Слово Тьмы: Смерть">
        <SpellID>32379</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return HealthByPercent("target") < 20;
]]></Lua>
      </Ability>
      <Ability Name="Слово тьмы: Боль">
        <SpellID>589</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff("target", 589, "PLAYER")) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Кара">
        <SpellID>585</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Свет" Spec="Priest_Holy">
      <HotKey Key="Z" Modifier="Alt" />
    </Rotation>
    <Rotation Name="Тьма" Spec="Priest_Shadow">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Божественное перышко">
        <SpellID>121536</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Левитация">
        <SpellID>1706</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not IsFalling() then
    falingStartTime = 0;
elseif IsFalling() and (falingStartTime or 0) == 0 then
    falingStartTime = GetTime();
elseif GetTime() - (falingStartTime or 0) > 1 and not HasBuff("player", 111759) then
    falingStartTime = 0;
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(8092), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Придание сил">
        <SpellID>10060</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return isInRange and useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Извержение Бездны">
        <SpellID>228260</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 194249) or UnitPower("player") > 85 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Темное сокрушение">
        <SpellID>205385</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Слово Тьмы: Смерть">
        <SpellID>32379</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Взрыв разума">
        <SpellID>8092</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Слово Тьмы: Боль">
        <SpellID>589</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 589, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Прикосновение вампира">
        <SpellID>34914</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 34914, "PLAYER")) < 6 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Исчадие Тьмы">
        <SpellID>34433</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Иссушение разума">
        <SpellID>48045</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return setAoE;
]]></Lua>
      </Ability>
      <Ability Name="Пытка разума">
        <SpellID>15407</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return isInRange;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="DeathKnight">
    <Lua><![CDATA[
setAoE = false;
useCooldown = true;
isAltMod = nil;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    end
end
]]></Lua>
    <Rotation Name="Кровь" Spec="DeathKnight_Blood">
      <HotKey Key="X" Modifier="Alt" />
      <Ability Name="Смерть и разложение">
        <SpellID>43265</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(49998), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Заморозка разума">
        <SpellID>47528</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Прикосновение смерти">
        <SpellID>195292</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 55078, "PLAYER")) < 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар смерти">
        <SpellID>49998</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Дробление хребта">
        <SpellID>195182</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(2, HasBuff("player", 195181)) < 7 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вскипание крови">
        <SpellID>50842</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Жнец душ">
        <SpellID>130736</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not setAoE and HealthByPercent(target) <= 35 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар в сердце">
        <SpellID>206930</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetRuneCount(1) > 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Усиление рунического оружия">
        <SpellID>47568</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and PLAYER.HP < 50 then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Лед" Spec="DeathKnight_Frost">
      <HotKey Key="Z" Modifier="Alt" />
      <Lua><![CDATA[
simulacrSpellTable = {
    0, -- Добавить сюда список заклинаний
};
]]></Lua>
      <Ability Name="Смерть и разложение">
        <SpellID>43265</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(49143), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Заморозка разума">
        <SpellID>47528</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Темный симулякр">
        <SpellID>77606</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>1</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
for _, spellId in ipairs(simulacrSpellTable) do
    local endTime,_,castId = UnitCastingInfo(target);
    if spellId == castId then
        if (((endTime / 1000) - GetTime()) - AddonFrame.ping) < 2 then
            return true
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Кровоотвод">
        <SpellID>45529</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local frost = DK_RUNES.FROST.FullCount;
local unholy= DK_RUNES.UNHOLY.FullCount;

if unholy == 0 or frost == 0 then
    if select(2, HasBuff("player", 114851)) >= 5 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Ледяной столб">
        <SpellID>51271</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Воскрешение мертвых">
        <SpellID>46584</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вспышка болезни">
        <SpellID>77575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local diseases = {
    55078, -- Кровавая чума
    55095, -- Озноб
};
if select(3, HasDebuff(target, diseases, "PLAYER")) < 3 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ледяной столб">
        <SpellID>51271</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    return DK_RUNES.Total < 2;
end
]]></Lua>
      </Ability>
      <Ability Name="Усиление рунического оружия">
        <SpellID>47568</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    return DK_RUNES.Total < 2;
end
]]></Lua>
      </Ability>
      <Ability Name="Жнец душ">
        <SpellID>130735</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HealthByPercent(target) < 35 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Воющий ветер">
        <SpellID>49184</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if setAoE then
    -- Используем только при АОЕ или когда надо обновить болезнь
    return select(3, HasDebuff(target, 55095, "PLAYER")) < 2; -- Озноб
end
]]></Lua>
      </Ability>
      <Ability Name="Удар чумы">
        <SpellID>45462</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return select(3, HasDebuff(target, 55078, "PLAYER")) < 3 -- Кровавая чума
]]></Lua>
      </Ability>
      <Ability Name="Ледяной удар (1H)">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Для одноручного оружия и при проке "Машина для убийств"
if not isTwoHand and HasBuff("player", 51124) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Воющий ветер (1H)">
        <SpellID>49184</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not isTwoHand;
]]></Lua>
      </Ability>
      <Ability Name="Уничтожение">
        <SpellID>49020</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Ледяной удар">
        <SpellID>49143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Для двуручного оружия или при максимуме рунической силы
return isTwoHand or DK_RUNES.Power > 90;
]]></Lua>
      </Ability>
      <Ability Name="Воющий ветер (2H)">
        <SpellID>49184</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Используем с двуручным оружием при проке "59057 - Инея"
if isTwoHand and HasBuff("player", 59057) then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Нечестивость" Spec="DeathKnight_Unholy">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

local curses = {
    155159 -- Мертвящая чума
};
]]></Lua>
      </Ability>
      <Ability Name="Смерть и разложение">
        <SpellID>43265</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Кровоотвод">
        <SpellID>45529</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if DK_RUNES.Death.Count < 1 then
    if (select(2, HasBuff("player", 114851)) or 0) >= 5 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Вспышка болезни">
        <SpellID>77575</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local diseases = {
    59879, -- Кровавая чума
    59921, -- Озноб
};
if not HasDebuff("target", diseases, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар чумы">
        <SpellID>45462</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff("target", curses, "PLAYER") then  -- Озноб
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Жнец душ">
        <SpellID>130736</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HealthByPercent("target") < 45 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар разложения">
        <SpellID>85948</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not setAoE and select(3, HasDebuff("target", curses)) < 10 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Темное превращение">
        <SpellID>63560</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
--Вливание тьмы
if UnitExists("pet") and select(2, HasBuff("player", 91342, "PLAYER")) > 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Лик смерти">
        <SpellID>47541</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Неумолимый рок (81340)
if DK_RUNES.Power > 90
or HasBuff("player", 81340)
or select(2, HasBuff("player", 91342)) < 4
or HasBuff("pet", 63560)
then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар плети">
        <SpellID>55090</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local debuff,_,rem = HasDebuff("target", 91342, "PLAYER");
if not debuff or rem > 10 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар разложения">
        <SpellID>85948</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not setAoE;
]]></Lua>
      </Ability>
      <Ability Name="Лик смерти">
        <SpellID>47541</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Shaman">
    <Rotation Name="Стихии" Spec="Shaman_Elemental">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Тотем землятресения">
        <SpellID>61882</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(403), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Пронизывающий ветер">
        <SpellID>57994</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Очищение духа">
        <SpellID>51886</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Перерождение">
        <SpellID>114050</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if isInRange and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Покорение стихий">
        <SpellID>16166</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInRange and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Огненный шок">
        <SpellID>188389</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff(target, 188389, "PLAYER") then
    return true;
elseif UnitPower("player") >= 20 and select(3, HasDebuff(target, 188389, "PLAYER")) < 10 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Выброс лавы">
        <SpellID>51505</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if setAoE and HasBuff("player", 77756) then
    return true;
elseif HasBuff("player", 77756) or not PLAYER.IsMoving then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар духов стихии">
        <SpellID>117014</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Ледяной шок">
        <SpellID>196840</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.IsMoving or HasBuff("player", 210714) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Земной шок">
        <SpellID>8042</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return UnitPower("player") > 90;
]]></Lua>
      </Ability>
      <Ability Name="Цепная молния">
        <SpellID>421</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return setAoE;
]]></Lua>
      </Ability>
      <Ability Name="Молния">
        <SpellID>403</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Дух предков">
        <SpellID>2008</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Совершенствование" Spec="Shaman_Enhancement">
      <HotKey Key="V" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(60103), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Очищение духа">
        <SpellID>51886</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Пронизывающий ветер">
        <SpellID>57994</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Песнь ветра">
        <SpellID>201898</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Перерождение">
        <SpellID>114051</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele and useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Дух дикого зверя">
        <SpellID>51533</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown and isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Ледяное клеймо">
        <SpellID>196834</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Буря с градом
if select(10, GetTalentInfo(4, 3, 1)) and select(3, HasBuff("player", 196834)) < 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Тяжелый кулак">
        <SpellID>201897</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Тяжелый кулак
if select(10, GetTalentInfo(1, 3, 1)) then
    if GetSpellCharges(ability.SpellName) > 1 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Удар бури">
        <SpellID>17364</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Вестник шторма
if HasBuff("player", 201846) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вскипание лавы">
        <SpellID>60103</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Горячая рука
if HasBuff("player", 215785) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Земляной шип">
        <SpellID>188089</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Язык пламени">
        <SpellID>193796</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Язык пламени
if select(3, HasBuff("player", 194084)) < 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар бури">
        <SpellID>17364</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Тяжелый кулак">
        <SpellID>201897</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(10, GetTalentInfo(1, 3, 1)) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Рскол">
        <SpellID>197214</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Молния">
        <SpellID>403</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(10, GetTalentInfo(5, 2, 1)) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Сокрушающая молния">
        <SpellID>187874</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and
    select(10, GetTalentInfo(6, 1, 1)) and UnitPower("player") > 90 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вскипание лавы">
        <SpellID>60103</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player") > 80 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Камнедробитель">
        <SpellID>193786</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Дух предков">
        <SpellID>2008</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Исцеление" Spec="Shaman_Restoration">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useAutoDispell = true;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RCTRL" then
        if useAutoDispell then
            useAutoDispell = false;
            AddonFrame.print("|cffff0000Автодиспел выключен", true);
        else
            useAutoDispell = true;
            AddonFrame.print("|cff00ff00Автодиспел включен", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Целительный ливень">
        <SpellID>73920</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return IsMouseButtonDown(3);
]]></Lua>
      </Ability>
      <Ability Name="Водяной щит">
        <SpellID>52127</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasBuff("player", 52127) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Щит земли">
        <SpellID>974</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
for _,member in ipairs(PartyLogic.members) do
    if member.Agro > 2 and member.IsTank then
        if select(3, HasBuff(member.Unit, 974, "PLAYER")) > 10 then
            return;
        end
    end
end

-- Накладываем щит земли на танка с агро
for _,member in ipairs(PartyLogic.members) do
    if member.Agro > 2 and member.IsTank then
        return member.Unit;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Пронизывающий ветер">
        <SpellID>57994</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Очищение духа">
        <SpellID>77130</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("mouseover") then
        return "mouseover";
    end
end
if useAutoDispell then
    return PartyLogic:GetDispellInfo();
end
]]></Lua>
      </Ability>
      <Ability Name="Цепное исцеление">
        <SpellID>1064</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic:LowHP(70) > 2 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Быстрина">
        <SpellID>61295</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
for _,member in ipairs(PartyLogic.members) do
    if member.HP < 70 or (member.IsTank and member.Agro > 2) then
        if not HasBuff(member.Unit, 61295, "PLAYER") then
            return member.Unit;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Исцелающий всплеск">
        <SpellID>8004</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic.First.HP < 60 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Тотем исцеляющего потока">
        <SpellID>5394</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic:LowHP(80) > 2 and not GetTotemInfo(3) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Опаляющий тотем">
        <SpellID>3599</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not setAoE and isInRange and UnitExists("target") and not GetTotemInfo(1) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Дух предков">
        <SpellID>2008</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if UnitIsDead("mouseover") and not UnitAffectingCombat("player") and UnitIsPlayer("mouseover") then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Mage">
    <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        --if setAoE then
        --    setAoE = false;
        --    AddonFrame.print("|cff00ff00Одиночная цель", true);
        --else
        --    setAoE = true;
        --    AddonFrame.print("|cffff0000AOE", true);
        --end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
    <Rotation Name="Огонь" Spec="Mage_Fire">
      <HotKey Key="V" Modifier="Alt" />
      <Ability Name="Огненный столб">
        <SpellID>2120</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsMouseButtonDown(3);
]]></Lua>
      </Ability>
      <Ability Name="Метеор">
        <SpellID>153561</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(2948), "target") == 1;

if PowerByPercent("player") < 50 then
    UseItemById(36799); -- Самоцвет маны
end
]]></Lua>
      </Ability>
      <Ability Name="Замедленное падение">
        <SpellID>130</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not IsFalling() then
    falingStartTime = 0;
elseif IsFalling() and (falingStartTime or 0) == 0 then
    falingStartTime = GetTime();
elseif GetTime() - (falingStartTime or 0) > 1 and not HasBuff("player", 130) then
    falingStartTime = 0;
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Антимагия">
        <SpellID>2139</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Зеркальное изображение">
        <SpellID>55342</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInRange and useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Огненная глыба">
        <SpellID>11366</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 48108) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Живая бомба">
        <SpellID>44457</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff(target, ability.SpellId, "PLAYER")
   and not HasBuff("player", 48107) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Возгорание">
        <SpellID>190319</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInRange then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Пламенный взрыв">
        <SpellID>108853</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 48107) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ожег">
        <SpellID>2948</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>Moving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Огненный шар">
        <SpellID>133</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Лед" Spec="Mage_Frost">
      <HotKey Key="X" Modifier="Alt" />
      <Ability Name="Руна мощи">
        <SpellID>116011</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkRightAlt);
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

if HasBuff("player", 87959) then
    return true;
end

isInRange = IsSpellInRange(GetSpellInfo(116), "target") == 1;

if IsMouseButtonDown(4) then
    if SpellCD(33395) == 0 then
        CastSpellByID(33395);
        CameraOrSelectOrMoveStart();
        CameraOrSelectOrMoveStop();
        CastSpellByID(33395);
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Замедленное падение">
        <SpellID>130</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- надо тестировать
if not IsFalling() then
    falingStartTime = 0;
elseif IsFalling() and (falingStartTime or 0) == 0 then
    falingStartTime = GetTime();
elseif GetTime() - (falingStartTime or 0) > 1 and not HasBuff("player", 130) then
    falingStartTime = 0;
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Снежная Буря">
        <SpellID>10</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Антимагия">
        <SpellID>2139</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Зеркальное изображение">
        <SpellID>55342</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInRange and useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Щит заклинателя">
        <SpellID>1463</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not HasBuff("player", 1463);
]]></Lua>
      </Ability>
      <Ability Name="Ледяная преграда">
        <SpellID>11426</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not HasBuff("player", 11426);
]]></Lua>
      </Ability>
      <Ability Name="Живая бомба">
        <SpellID>44457</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsSpellInRange(GetSpellInfo(116), target) == 1 then
    if not HasDebuff(target, ability.SpellId, "PLAYER") then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Стрела ледяного огня">
        <SpellID>44614</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 44549) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Ледяное копье">
        <SpellID>30455</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 112965) or (PLAYER.IsMoving and not HasBuff("player", 108839)) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Плавучая льдина">
        <SpellID>108839</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>Moving</IsMovingCheck>
        <Lua><![CDATA[
if isInRange then
    local bufs = {
        44549,  -- Заморозка мозгов
        108839, -- Плавучая льдина
        112965, -- Ледяные пальцы
    };
    if not HasBuff("player", bufs) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Ледяная стрела">
        <SpellID>116</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Чародейская гениальность">
        <SpellID>1459</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return not HasBuff("player", 1459);
]]></Lua>
      </Ability>
      <Ability Name="Морозный доспех">
        <SpellID>7302</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>3</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return not HasBuff("player", 7302);
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Тайная магия" Spec="Mage_Arcane">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Руна мощи">
        <SpellID>116011</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown and not GetTotemInfo(1);
]]></Lua>
      </Ability>
      <Ability Name="Сверхновая">
        <SpellID>157980</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Мощь тайной магии">
        <SpellID>12042</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInRange and useCooldown  then
    if SpellCD(12051) == 0 and UnitPower("player", 16) >= 4 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Чародейские стрелы">
        <SpellID>5143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
-- save
if select(2, HasBuff("player", 79683)) >= 3 then
    return true;
-- burn
elseif HasBuff("player", 12042) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Прилив сил">
        <SpellID>12051</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if SpellCD(12042) > 10 and PowerByPercent("player") < 50 then
    if UnitPower("player", 16) >= 4 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Чародейская вспышка">
        <SpellID>30451</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
-- save
if PowerByPercent("player") > 90 and UnitPower("player", 16) >= 4 then
    return true;
-- burn
elseif PowerByPercent("player") > 50 and HasBuff("player", 12042) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Чародейские стрелы">
        <SpellID>5143</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player", 16) >= 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Чародейный обстрел">
        <SpellID>44425</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player", 16) >= 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Чародейская вспышка">
        <SpellID>30451</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if SpellCD(44425) > 0 or UnitPower("player", 16) < 4 then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Warlock">
    <Lua><![CDATA[
setAoE = false;
useCooldown = true;
]]></Lua>
    <Rotation Name="Колдовство" Spec="Warlock_Affliction">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
AhonyImmune = {
    ids = {
        33113, -- Огненный левиафан (Ульдуар)
    },
    IsImmune = function(self, target)
        if UnitExists(target) then
            local id = UnitId(target);
            for i,v in ipairs(self.ids) do
                if v == id then
                    return true;
                end
            end
        end
    end
};

bossTargetState = false;
SetTargetListState(bossTargetState, "boss%d");

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RALT" then
        if bossTargetState then
            bossTargetState = false;
            AddonFrame.print("|cffff0000Мультидотинг боссов выключен", true);
        else
            bossTargetState = true;
            AddonFrame.print("|cff00ff00Мультидотинг боссов включен", true);
        end
        SetTargetListState(bossTargetState, "boss%d");
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

-- Move pet to mouseover location
if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
      </Ability>
      <Ability Name="Замок мира теней">
        <SpellID>171140</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if CheckInterrupt(target) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Семя порчи">
        <SpellID>27243</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>3</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if setAoE then
    if not HasDebuff(target, ability.SpellId, "PLAYER") then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Агония">
        <SpellID>980</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <Target>Boss1</Target>
        <Target>Boss2</Target>
        <Target>Boss3</Target>
        <Target>Boss4</Target>
        <Target>Boss5</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not AhonyImmune:IsImmune(target)
and select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Порча">
        <SpellID>172</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <Target>Boss1</Target>
        <Target>Boss2</Target>
        <Target>Boss3</Target>
        <Target>Boss4</Target>
        <Target>Boss5</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasDebuff(target, ability.SpellId, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Вытягивание жизни">
        <SpellID>63106</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <Target>Boss1</Target>
        <Target>Boss2</Target>
        <Target>Boss3</Target>
        <Target>Boss4</Target>
        <Target>Boss5</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Нестабильное колдовство">
        <SpellID>30108</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <Target>Boss1</Target>
        <Target>Boss2</Target>
        <Target>Boss3</Target>
        <Target>Boss4</Target>
        <Target>Boss5</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>1</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 4 then
    -- Изваяние души
    if UnitId(target) ~= 103679 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Жизнеотвод">
        <SpellID>1454</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PowerByPercent("player") < 60 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Похищение жизни">
        <SpellID>689</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Демонология" Spec="Warlock_Demonology">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end

SUMMON_STALKERS = 1;
SUMMON_IMPS     = 2;

PETS = {
    list = { },

    Init = function(self)
        for slot = 1, 4 do
            local haveTotem, name, startTime, duration, icon = GetTotemInfo(slot);
            if string.match(icon, "calldreadstalkers") then
                self.list[SUMMON_STALKERS] = GetTotemTimeLeft(slot);
            elseif string.match(icon, "summonimpoutland") then
                self.list[SUMMON_IMPS] = GetTotemTimeLeft(slot);
            end
        end
    end,

    GetSummonInfo = function(self, id)
        return self.list[id] or -1;
    end,
};
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

-- Move pet to mouseover location
if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end

PETS:Init();
]]></Lua>
      </Ability>
      <Ability Name="Рок">
        <SpellID>603</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 603, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Жизнеотвод">
        <SpellID>1454</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PowerByPercent("player") < 60 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Призыв зловещих охотников">
        <SpellID>104316</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>3</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PETS:GetSummonInfo(SUMMON_STALKERS) <= 0 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Рука Гул'дана">
        <SpellID>105174</SpellID>
        <Target>Target</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player", SPELL_POWER_SOUL_SHARDS) > 3
and PETS:GetSummonInfo(SUMMON_IMPS) <= 0 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Демоническое усиление">
        <SpellID>193396</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasBuff("pet", 193396, "PLAYER")) < 2 then
    if PETS:GetSummonInfo(SUMMON_STALKERS) > 3        -- Охотники
    or PETS:GetSummonInfo(SUMMON_IMPS) > 3 then   -- Импы
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Демонический гнев">
        <SpellID>193440</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PETS:GetSummonInfo(SUMMON_STALKERS) > 4
or PETS:GetSummonInfo(SUMMON_IMPS) > 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Стрела тьмы">
        <SpellID>686</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Разрушение" Spec="Warlock_Destruction">
      <HotKey Key="V" Modifier="Alt" />
      <Lua><![CDATA[
useChaosBold = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted then
    return true;
end

-- Move pet to mouseover location
if IsMouseButtonDown(4) then
    PetMoveTo();
    CameraOrSelectOrMoveStart();
    CameraOrSelectOrMoveStop();
    PetMoveTo();
end
]]></Lua>
      </Ability>
      <Ability Name="Огненный ливень">
        <SpellID>5740</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Жертвенный огонь">
        <SpellID>348</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>1</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, ability.SpellId, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Поджигаие">
        <SpellID>17962</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player", SPELL_POWER_SOUL_SHARDS) < 4 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Хаос">
        <SpellID>80240</SpellID>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not IsModKeyDown(mkLeftShift) then
    if not UnitIsUnit("target", target)
    and UnitPower("player", SPELL_POWER_SOUL_SHARDS) > 1 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Стрела хаоса">
        <SpellID>116858</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Испепеление">
        <SpellID>29722</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Monk">
    <Lua><![CDATA[
useCooldown = true;
]]></Lua>
    <Rotation Name="Хмелевар" Spec="Monk_Brewmaster">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        --if setAoE then
        --    setAoE = false;
        --    AddonFrame.print("|cff00ff00 Одиночная цель", true);
        --else
        --    setAoE = true;
        --    AddonFrame.print("|cffff0000 AOE", true);
        --end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cffff0000Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cff00ff00Автопрерывания включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Статуя быка">
        <SpellID>115315</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(100780), "target") == 1;
energy     = UnitPower("player");
]]></Lua>
      </Ability>
      <Ability Name="Рука-копье">
        <SpellID>116705</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Отвар железной шкуры">
        <SpellID>115308</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
--if select(2, HasBuff("player", 128939)) > 9 then
--    return true;
--end
]]></Lua>
      </Ability>
      <Ability Name="Очищающий отвар">
        <SpellID>119582</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- (124275) Легкое пошатывание
-- (124274) Умеренное пошатывание
-- (124273) Сильное пошатывание
-- Снимаем только при "Сильном пошатывании"
if HasDebuff("player", 124273) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Детоксикация">
        <SpellID>218164</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Укрепляющий отвар">
        <SpellID>115203</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 40 and useCooldown then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Устранение вреда">
        <SpellID>115072</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 80 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Нокаутирующий удар">
        <SpellID>205523</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not HasBuff("player", 228563) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Удар бочонком">
        <SpellID>121253</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Пламенное дыхание">
        <SpellID>115181</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
--  Удар бочонком
if isInMeele and HasDebuff("target", 121253, "PLAYER") then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Порыв нефритового ветра">
        <SpellID>116847</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Нокаутирующий удар">
        <SpellID>205523</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Лапа тигра">
        <SpellID>100780</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitPower("player") > 40 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Воскрешение">
        <SpellID>115178</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Ткач туманов" Spec="Monk_Mistweaver">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Благотворный туман">
        <SpellID>116964</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
      <Ability Name="Успокаивающий туман">
        <SpellID>115175</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
      <Ability Name="Заживляющий туман">
        <SpellID>115151</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
      <Ability Name="Духовный подъем">
        <SpellID>116670</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
      <Ability Name="Окутывающий туман">
        <SpellID>124682</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
    </Rotation>
    <Rotation Name="Танцующий с ветром" Spec="Monk_Windwalker">
      <HotKey Key="V" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00 Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000 AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

if HasDebuff("target", { 115078 }) then
    StopAttack();
    PetStopAttack();
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(100780), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Смертельное касание">
        <SpellID>115080</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useCooldown;
]]></Lua>
      </Ability>
      <Ability Name="Рука-копье">
        <SpellID>116705</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Детоксикация">
        <SpellID>218164</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic:GetDispellInfo(target);
]]></Lua>
      </Ability>
      <Ability Name="Порыв нефритового верта">
        <SpellID>116847</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return setAoE;
]]></Lua>
      </Ability>
      <Ability Name="Удар крутящегося дракона">
        <SpellID>152175</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Удар восходящего солнца">
        <SpellID>107428</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Волна ци">
        <SpellID>115098</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Неистовые кулаки">
        <SpellID>113656</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Нокаутирующий удар">
        <SpellID>100784</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 116768) or UnitPower("player", 12) > 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Лапа тигра">
        <SpellID>100780</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Воскрешение">
        <SpellID>115178</SpellID>
        <Target>Target</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") then
    if UnitIsDeadOrGhost(target) and UnitIsPlayer(target) then
        return true;
    end
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="Druid">
    <Lua><![CDATA[
useCooldown = true;
setAoE      = nil;
isCat       = nil;
useAutoDispell = true;
]]></Lua>
    <Rotation Name="Лекарь" Spec="Druid_Restoration">
      <HotKey Key="Z" Modifier="Alt" />
      <Lua><![CDATA[
useAutoDispell = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "RCTRL" then
        if useAutoDispell then
            useAutoDispell = false;
            AddonFrame.print("|cffff0000Автодиспел выключен", true);
        else
            useAutoDispell = true;
            AddonFrame.print("|cff00ff00Автодиспел включен", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- пауза
--if IsModKeyDown(mkLeftShift) then
--    for index = 1, NUM_WORLD_RAID_MARKERS do
--        if not IsRaidMarkerActive(index) then
--            PlaceRaidMarker(index);
--            break;
--        end
--    end
--    return true;
--end
]]></Lua>
      </Ability>
      <Ability Name="Возрождение">
        <SpellID>20484</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Перк "Усиленное возрождение" (157301)
if not PLAYER.IsMoving or (PLAYER.IsMoving and IsSpellKnown(157301)) then
    if not HasDebuff(target, 160029) then
        return IsModKeyDown(mkLeftShift) and UnitIsDeadOrGhost(target) and UnitIsPlayer(target);
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Оживление">
        <SpellID>50769</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not UnitAffectingCombat("player") and UnitIsPlayer(target)
    and (UnitIsDeadOrGhost(target) or UnitIsCorpse(target))
    and not HasDebuff(target, 160029) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Дикий гриб">
        <SpellID>145205</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Колеcико мышки
return IsMouseButtonDown(3);
]]></Lua>
      </Ability>
      <Ability Name="Пауза">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- если персонаж на маунте или в форме или "Слился с тенью", тогда не выполняем ротацию дальше
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() or HasBuff("player", 104270)
    or (GetShapeshiftForm() ~= 0 and GetShapeshiftForm() ~= 6) then
    return true;
end

-- Если кастуем спокойствие - тогда ничего не делаем
if UnitChannelInfo("player") then
    return true;
end

-- используем аксесуар на ману, только в форме исцеления (0)
if PowerByPercent("player", SPELL_POWER_MANA) < 80 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET2);
end

if PowerByPercent("player", SPELL_POWER_MANA) < 70 and GetShapeshiftForm() == 0 then
    UseItemBySlot(INVSLOT_TRINKET1);
end

if PartyLogic:LowHP(50) > 3 and UnitAffectingCombat("player") then
    UseItemBySlot(INVSLOT_HAND); -- Нейронные пружины
end

if HasBuff("player", 106898) and GetShapeshiftForm() == 1 then
    CancelShapeshiftForm();
end
]]></Lua>
      </Ability>
      <Ability Name="Гнев">
        <SpellID>5176</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift);
]]></Lua>
      </Ability>
      <Ability Name="Природный целитель">
        <SpellID>88423</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(5) then
    if UnitExists("mouseover") then
        return "mouseover";
    end
end
if useAutoDispell then
    return PartyLogic:GetDispellInfo();
end
]]></Lua>
      </Ability>
      <Ability Name="Железная кора">
        <SpellID>102342</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
for _,member in ipairs(PartyLogic.members) do
    -- Железную кору используем только на танка
    if member.IsTank and member.HP < 30 then
        return member.Unit;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Дубовая кора">
        <SpellID>22812</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HealthByPercent("player") < 25 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Умиротворение">
        <SpellID>2908</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckEnrage(target);
]]></Lua>
      </Ability>
      <Ability Name="Сила Природы">
        <SpellID>102693</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local member_count = IsInRaid() and PartyLogic:LowHP(50) or PartyLogic:LowHP(70);
if GetSpellCharges(102693) > 2 or member_count > 3 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Природная стремительность">
        <SpellID>132158</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return PartyLogic.First.HP < 40;
]]></Lua>
      </Ability>
      <Ability Name="Целительное прикосновение">
        <SpellID>5185</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- 132158 Природная стремительность
-- Следующее заклинание используется мгновенно
-- и не требует затрат ресурсов
if HasBuff("player", 132158) then
    -- Природную стремительность используем
    -- если у кого-то меньше 40% здоровья
    -- тут поставим проверку с запасом, так на всякий случай
    if PartyLogic.First.HP < 50 then
        return PartyLogic.First.Unit;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Восстановление">
        <SpellID>8936</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 16870) and UnitAffectingCombat("player") then
    -- Используем только под проком ясности мысли, в дереве хилим на ходу
    -- Хилим либо просевшие цели либо когда нам надо обновить Гармонию
    local harmonyRemains = select(3, HasBuff("player", 100977));
    if PartyLogic.First.HP <= 70 or harmonyRemains < 4 then
        if (GetShapeshiftForm() == 6 or not PLAYER.IsMoving) then
            return PartyLogic.First.Unit;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Быстрое восстановление">
        <SpellID>18562</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Либо обновляем Гармонию, либо хилим просевшую цель.
-- Проверяем только наличие бафа Омоложение
local harmonyRemains = select(3, HasBuff("player", 100977));
for _,member in ipairs(PartyLogic.members) do
    if HasBuff(member.Unit, 774, "PLAYER") and (member.HP < 85 or harmonyRemains < 4) then
        --print(member.Unit, UnitName(member.Unit), member.HP, harmonyRemains);
        return member.Unit;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Буйный рост">
        <SpellID>48438</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
-- Очень дорогой АОЕ-хил,
-- применять нужно только если в рейде просажено более 3х-5ти целей до 70% хп и ниже.
local count = IsInRaid() and 5 or 3;
local member_count = IsInRaid() and PartyLogic:LowHP(70) or PartyLogic:LowHP(70);

if UnitExists("mouseover") and IsMouseButtonDown(5) then
    return "mouseover";
elseif (member_count > count and UnitAffectingCombat("player"))
    or IsMouseButtonDown(5) then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Жизнецвет">
        <SpellID>33763</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Проверяем наличе уже повешенного жизнецвета
-- чтобы во время боя (при агро на 2х танках) жизнецвет не перекидывало с одного на другого.

-- Надо реализовать механизм переброса жизнецвета если 1 танк просел сильно а агро на 2х.

for _,member in ipairs(PartyLogic.members) do
    if member.Agro > 2 and HasBuff(member.Unit, 33763, "PLAYER") then
        return;
    end
end

for _,member in ipairs(PartyLogic.members) do
    if member.Agro > 2 and (not PartyLogic.HasTank or member.IsTank) then
        if not HasBuff(member.Unit, 33763, "PLAYER") then
            return member.Unit;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Сотворение">
        <SpellID>145518</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local count = 0;

if IsMouseButtonDown(4) then
    return true;
end

for _,member in ipairs(PartyLogic.members) do
    if member.HP < 40 and select(3, HasBuff(member.Unit, 774, "PLAYER")) > 4 then
        count = count + 1;
        if count > 3 then
            return true;
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Омоложение">
        <SpellID>774</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local hasGermination = IsSpellKnown(155675); -- Зарождеине (Талант)

if IsModKeyDown(mkLeftControl)
    and UnitExists("mouseover")
    and UnitHealth("mouseover") > 100 -- это хаковая проверка на призывных юнитов (гриб друида и т.п.)
    and UnitCanAssist("player", "mouseover") then
    if not (HasBuff("mouseover", 774, "PLAYER")
        and (not hasGermination or HasBuff("mouseover", 155777, "PLAYER")))  then
        return "mouseover";
    end
end

-- ВАЖНО:
-- Накладыввя второй раз Омоложение при активном таланте "Зарождение" мы накладываем
-- бафф "155777 - Зарождение", которое не обновляет время действия "774 - Омоложения".
-- Да и вообще бафы друг друга не обновляют. 156954
if IsModKeyDown(mkLeftControl) or UnitAffectingCombat("player") then
    local hp_rej = IsInRaid() and 70 or 80;
    local hp_ger = IsInRaid() and 55 or 60;

    for _,member in ipairs(PartyLogic.members) do
        if member.HP < hp_rej or member.Agro > 2 or IsModKeyDown(mkLeftControl) then
            local rejuvenation = HasBuff(member.Unit, 774,    "PLAYER"); -- Омоложение
            local germination  = HasBuff(member.Unit, 155777, "PLAYER"); -- Омоложение (Зарождение бафф)

            -- Накладываем хоту если есть талант "Зарождение" и меньше 60% здоровья
            if not rejuvenation or (hasGermination and not germination and
                (member.HP < hp_ger or member.IsTank)) then
                return member.Unit;
            end
        end
    end
 end
]]></Lua>
      </Ability>
      <Ability Name="Восстановление">
        <SpellID>8936</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic.First.HP <= 30 then
    -- В дереве хилим на ходу
    if GetShapeshiftForm() == 6 or not PLAYER.IsMoving then
        return PartyLogic.First.Unit;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Целительное прикосновение">
        <SpellID>5185</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if PartyLogic.First.HP <= 60 then
    return PartyLogic.First.Unit;
end
]]></Lua>
      </Ability>
      <Ability Name="Знак дикой природы">
        <SpellID>1126</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not (GetRaidBuffTrayAuraInfo(1) and GetRaidBuffTrayAuraInfo(9)) then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Страж" Spec="Druid_Guardian">
      <HotKey Key="X" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
isAltMod = true;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if not setAoE then
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        else
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        end
    elseif modifier == "RALT" then
        if isAltMod then
            isAltMod = false;
            AddonFrame.print("|cffff0000Используется \'Дикая защита\'", true);
        else
            isAltMod = true;
            AddonFrame.print("|cff00ff00Используется \'Неистовое восстановление\'", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted
    or GetShapeshiftForm() ~= 1
    or IsStealthed() then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(33917), "target") == 1;

if isInMeele and useCooldown and SpellCD(33917) == 0
    and UnitAffectingCombat("player") then
    UseItemBySlot(INVSLOT_HAND);
    UseItemBySlot(INVSLOT_TRINKET1);
    UseItemBySlot(INVSLOT_TRINKET2);
end
]]></Lua>
      </Ability>
      <Ability Name="Лобовая атака">
        <SpellID>106839</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Неистовое восстановление">
        <SpellID>22842</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.HP < 80 and not HasBuff("player", 22842) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Железный мех">
        <SpellID>192081</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.Agro > 2 and select(2, HasBuff("player", 192081)) < 2 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Метка Урсола">
        <SpellID>192083</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
--if PLAYER.Agro > 2 and not HasBuff("player", 192083) then
--    return true;
--end
]]></Lua>
      </Ability>
      <Ability Name="Дубовая кожа">
        <SpellID>22812</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and PLAYER.HP < 50 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Инстинкты выживания">
        <SpellID>61336</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and PLAYER.HP < 35 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Увечье">
        <SpellID>33917</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Взбучка">
        <SpellID>77758</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 164812, "PLAYER")) < 5 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Размах">
        <SpellID>213764</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Трепка">
        <SpellID>6807</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.Agro < 3 or UnitPower("player") > 80 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Сила зверя" Spec="Druid_Feral">
      <HotKey Key="C" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00 Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000 AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cffff0000Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cff00ff00Автопрерывания включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

if GetShapeshiftForm() ~= 2 then
    return true;
end

isInMeele  = IsSpellInRange(GetSpellInfo(5221), "target") == 1;
]]></Lua>
      </Ability>
      <Ability Name="Возрождение">
        <SpellID>20484</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 69369) then
    return UnitIsDeadOrGhost(target) and UnitIsPlayer(target);
end
]]></Lua>
      </Ability>
      <Ability Name="Снятие порчи">
        <SpellID>2782</SpellID>
        <Target>Focus</Target>
        <Target>Player</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return false;-- надо доработать
]]></Lua>
      </Ability>
      <Ability Name="Лобовая атака">
        <SpellID>106839</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Берсерк">
        <SpellID>106951</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and useCooldown then
    if UnitPower("player") > 50 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Тигриное неистовство">
        <SpellID>5217</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and UnitPower("player") < 50 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Перевоплощение: Король джунглей">
        <SpellID>102543</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInMeele and HasBuff("player", 106952) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Целительное прикосновение">
        <SpellID>5185</SpellID>
        <Target>Focus</Target>
        <Target>Player</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HasBuff("player", 69369) and HealthByPercent(terget) < 90 then
     return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Дикий рев">
        <SpellID>52610</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and select(3, HasBuff("player", 52610)) > 7 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Взбучка">
        <SpellID>106832</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and setAoE then
    if select(3, HasDebuff("target", 106830, "PLAYER")) < 2 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Размах">
        <SpellID>106785</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if setAoE and isInMeele then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Разорвать">
        <SpellID>1079</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") > 4 and select(3, HasDebuff("target", 1079)) < 6 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Свирепый укус">
        <SpellID>22568</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetComboPoints("player", "target") > 4 and UnitPower("player") >= 40 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Глубокая рана">
        <SpellID>1822</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff("target", 1822)) < 3 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Полоснуть">
        <SpellID>5221</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return UnitPower("player") >= 50;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Баланс" Spec="Druid_Balance">
      <HotKey Key="V" Modifier="Alt" />
      <Lua><![CDATA[
setAoE = false;
useCooldown = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if setAoE then
            setAoE = false;
            AddonFrame.print("|cff00ff00Одиночная цель", true);
        else
            setAoE = true;
            AddonFrame.print("|cffff0000AOE", true);
        end
    elseif modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    end
end
]]></Lua>
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

if GetShapeshiftFormCooldown(4) == 0 and GetShapeshiftForm() ~= 4 then
    if UnitAffectingCombat("player") then
        CastShapeshiftForm(4);
    end
end

isInRange = IsSpellInRange(GetSpellInfo(5176), "target") == 1;
power     = UnitPower("player", SPELL_POWER_ECLIPSE);
]]></Lua>
      </Ability>
      <Ability Name="Возрождение">
        <SpellID>20484</SpellID>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return IsModKeyDown(mkLeftShift) and UnitIsDeadOrGhost(target) and UnitIsPlayer(target);
]]></Lua>
      </Ability>
      <Ability Name="Дубовая кора">
        <SpellID>22812</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if HealthByPercent("player") < 25 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Солнечный столб">
        <SpellID>78675</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>true</CancelChannel>
        <CancelCasting>true</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return CheckInterrupt(target);
]]></Lua>
      </Ability>
      <Ability Name="Звездопад">
        <SpellID>191034</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Парад планет">
        <SpellID>194223</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if useCooldown and isInRange then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Лунный огонь">
        <SpellID>8921</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if PLAYER.IsMoving or select(3, HasDebuff(target, 164812, "PLAYER")) < 7 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Солнечный огонь">
        <SpellID>93402</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if select(3, HasDebuff(target, 164815, "PLAYER")) < 6 then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Звездный поток">
        <SpellID>78674</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
local min_power = select(5, GetTalentInfo(5, 1, 1)) and 60 or 50;

if UnitPower("player") > min_power then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Звездный огонь">
        <SpellID>194153</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if setAoE or HasBuff("player", 164547) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Гнев">
        <SpellID>190984</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Благословение древних">
        <SpellID>202360</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
      </Ability>
    </Rotation>
    <Rotation Name="none" Spec="None">
      <HotKey Key="B" Modifier="Alt" />
      <Ability Name="Rip">
        <SpellID>1079</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="DemonHunter">
    <Lua><![CDATA[
setAoE = false;
useCooldown = true;
useInterrupt = true;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    --if modifier == "LCTRL" then
    --    if setAoE then
    --        setAoE = false;
    --        AddonFrame.print("|cff00ff00Одиночная цель", true);
    --    else
    --        setAoE = true;
    --        AddonFrame.print("|cffff0000AOE", true);
    --    end
    --else
    if modifier == "RSHIFT" then
        if useCooldown then
            useCooldown = false;
            AddonFrame.print("|cffff0000Кулдауны выключены", true);
        else
            useCooldown = true;
            AddonFrame.print("|cff00ff00Кулдауны включены", true);
        end
    elseif modifier == "RCTRL" then
        if useInterrupt then
            useInterrupt = false;
            AddonFrame.print("|cff00ff00Автопрерывания выключены", true);
        else
            useInterrupt = true;
            AddonFrame.print("|cffff0000Автопрерывания включены", true);
        end
    end
end
]]></Lua>
    <Rotation Name="Сокрушение" Spec="DemonHunter_Havoc">
      <HotKey Key="X" Modifier="Alt" />
      <Ability Name="Init">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Поглощение магии">
        <SpellID>183752</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Удар Хаоса">
        <SpellID>162794</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Укус демона">
        <SpellID>162243</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Месть" Spec="DemonHunter_Vengeance">
      <HotKey Key="C" Modifier="Alt" />
      <Ability Name="Инфернальный удар">
        <SpellID>189110</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftShift) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Печать огня">
        <SpellID>204596</SpellID>
        <Target>MouseLocation</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsMouseButtonDown(3) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Init">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if IsModKeyDown(mkLeftAlt) or PLAYER.IsMounted or IsStealthed() then
    return true;
end

isInMeele = IsSpellInRange(GetSpellInfo(162243),"target")==1;
]]></Lua>
      </Ability>
      <Ability Name="Поглощение магии">
        <SpellID>183752</SpellID>
        <Target>Target</Target>
        <Target>Focus</Target>
        <Target>Mouseover</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return useInterrupt and CheckInterrupt("target");
]]></Lua>
      </Ability>
      <Ability Name="Демонические шипы">
        <SpellID>203720</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele and PLAYER.Agro > 2 then
    -- Демонические шипы
    if not HasBuff("player", 203819) then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Раскалывание душ">
        <SpellID>228477</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isInMeele then
    if PLAYER.Agro > 2 and (UnitPower("player") > 50 and PLAYER.HP < 80) or PLAYER.HP > 90 then
        return true;
    elseif PLAYER.Agro < 2 then
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Жар преисподней">
        <SpellID>178740</SpellID>
        <Target>Player</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return isInMeele;
]]></Lua>
      </Ability>
      <Ability Name="Иссечение">
        <SpellID>203782</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
      <Ability Name="Бросок боевого клинка">
        <SpellID>204157</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
return true;
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
  <Profile Class="None">
    <Rotation Name="Малигос" Spec="None">
      <HotKey Key="M" Modifier="Alt Shift" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitHasVehicleUI("player") then
    return true;
end

if IsModKeyDown(mkLeftAlt) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Дыхание жизни">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(4) == 0 then
    if HealthByPercent("vehicle") < 40 and not HasBuff("vehicle", 57143) then
        if select(2, HasBuff("player", 57090)) > 3 then
            CastPetAction(4);
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Реанимация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(3) == 0 then
    if     HealthByPercent("vehicle") < 90 then
        if select(2, HasBuff("vehicle", 57090)) < 1 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 70 then
        if select(2, HasBuff("vehicle", 57090)) < 2 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 50 then
        if select(2, HasBuff("vehicle", 57090)) < 3 then
            CastPetAction(3);
        end
    elseif HealthByPercent("vehicle") < 30 then
        if select(2, HasBuff("vehicle", 57090)) < 4 then
            CastPetAction(3);
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Окутать пламенем">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>true</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(2) == 0 and GetComboPoints("vehicle") > 2 then
    CastPetAction(2, target);
end
]]></Lua>
      </Ability>
      <Ability Name="Пламенный шип">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(1) == 0 and GetComboPoints("vehicle") < 3 then
    CastPetAction(1, target);
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Серебряный авангард (Турнир)" Spec="None">
      <HotKey Key="T" Modifier="Alt Shift" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitHasVehicleUI("player") then
    return true;
end

if IsModKeyDown(mkLeftAlt) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Защита">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>1</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(4) == 0 then
    local col, rem = select(2, HasBuff("vehicle", 62552));
    if col < 3 or rem < 5 then
        CastPetAction(4);
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Удар по щиту">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- как-то определть дистанцию до цели
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(2) == 0 then
    if select(2, HasBuff("target", 62719)) > 1 then
        CastPetAction(2);
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Рывок">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- как-то определть дистанцию до цели
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(3) == 0 then
    if select(2, HasBuff("target", 62719)) <= 1 then
        CastPetAction(3);
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Выпад">
        <SpellID>0</SpellID>
        <Target>Target</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if UnitExists("target") and UnitIsEnemy("player", "target")
    and GetPetActionCooldown(1) == 0 then
    CastPetAction(1);
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Ульдуар - Левиафан" Spec="None">
      <HotKey Key="C" Modifier="Alt Shift" />
      <Ability Name="Инициализация">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if not UnitHasVehicleUI("player") then
    return true;
end

if IsModKeyDown(mkLeftAlt) then
    return true;
end
]]></Lua>
      </Ability>
      <Ability Name="Бросок валуна">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(1) == 0 then
    CastPetAction(1);
end
]]></Lua>
      </Ability>
      <Ability Name="Бросок бочки колчедана">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(2) == 0 then
    CastPetAction(2);
end
]]></Lua>
      </Ability>
      <Ability Name="Таран">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if GetPetActionCooldown(3) == 0 then
    CastPetAction(3);
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Волчеры (Сбежавшая курица)" Spec="None">
      <HotKey Key="K" Modifier="Alt Shift" />
      <Ability Name="Сбежавшая курица">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
ClearTarget();
TargetUnit("Сбежавшая курица");
if UnitExists("target") and CheckInteractDistance("target", 2) then
    InteractUnit("target");
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Рыбалка" Spec="None">
      <HotKey Key="F" Modifier="Alt Shift" />
      <Lua><![CDATA[
SetPOIIconOverlapDistance(12.01);
isFishPause = false;
autoUseLure = false;

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key

    if modifier == "LCTRL" then
        if isFishPause then
            isFishPause = false;
            SetPOIIconOverlapDistance(12.01);
            AddonFrame.print("|cff00ff00Ловим рыбку!", true);
        else
            isFishPause = true;
            SetPOIIconOverlapDistance(12.00);
            AddonFrame.print("|cffff0000>>Пауза<<", true);
        end
    end

    if modifier == "RCTRL" then
        if autoUseLure then
            autoUseLure = false;
            AddonFrame.print("|cffff0000>>Автонаживка не используется!<<", true);
        else
            autoUseLure = true;
            AddonFrame.print("|cff00ff00Автонживка!", true);
        end
    end
end

ZONE_BUFF_TABLE = {
    -- == ДРЕНОР == --
    --[978] = { item = 0, buff = 0 }, -- Ашран
    --[945] = { item = 0, buff = 0 }, -- Танаанские джунгли
    [949] = { item = 110274, buff = 158031 }, -- Горгронд (Наживка для безротого скрытиуса)
    [947] = { item = 110290, buff = 158035 }, -- Долина Призрачной Луны (Наживка для слепого озерного осетра)
    [950] = { item = 110289, buff = 158034 }, -- Награнд (Наживка для толстопузика)
    [948] = { item = 110293, buff = 158038 }, -- Пики Арака (Наживка на глубинного угря-мешкорота)
    [946] = { item = 110294, buff = 158039 }, -- Таладор (Наживка для хлыстохвоста Черноводья)
    [941] = { item = 110291, buff = 158036 }, -- Хребет Ледяного Огня (Наживка для огненного аммонита)

    -- == ЛЕГИОН == --
    --[0] = { item = 0, buff = 0 },
};
]]></Lua>
      <Ability Name="Щелкнуть по крючку">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
if isFishPause then
    return true;
end

if IsFishingLoot()
or IsMounted()
or IsStealthed()
or IsFlying()
or IsModKeyDown(mkLeftAlt)
or UnitAffectingCombat("player") then
    return true;
end

if select(2, UnitClass("player")) == "DRUID" then
    local f = GetShapeshiftForm();
    if f ~= 0 and f ~= 4 then
        return true;
    end
end

if UnitChannelInfo("player") then
    if IsTestBuild() then
        print("|cff6f0a9a>>Поймали рыбку!|r");
        InteractUnit("mouseover");
        return true;
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Наживки/Бафы">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>None</IsMovingCheck>
        <Lua><![CDATA[
-- Плот рыболова (предмет и бафф)
if select(3, HasBuff("player", 124036)) < 30 then
    UseItemById(85500);
end

if autoUseLure then
    -- Автоприменение наживки в зависимости от зоны
    local zone = GetCurrentMapAreaID();
    local val = ZONE_BUFF_TABLE[zone];
    if val then
        assert(val.item ~= 0, string.format("Для зоны (%d) не указан Id предмета!"));
        assert(val.buff ~= 0, string.format("Для зоны (%d) не указан Id бафа!"));
        if not HasBuff("player", val.buff) then
            UseItemById(val.item);
        end
    end
end
]]></Lua>
      </Ability>
      <Ability Name="Рыбная ловля">
        <SpellID>131474</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>false</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if not IsFishingLoot() then
    return true;
end
]]></Lua>
      </Ability>
    </Rotation>
    <Rotation Name="Утилизация" Spec="None">
      <HotKey Key="U" Modifier="Alt Shift" />
      <Lua><![CDATA[
autoOpenEnabled = false

UTILS_CONTAINER = {
    114116, -- Сумка с утилем
    114120, -- Большой ящик с утилем
};

function EVENT_MODS.MODIFIER_STATE_CHANGED(modifier, state)
    if state == 0 then return end; -- release key
    if modifier == "RSHIFT" then
        if not autoOpenEnabled then
            autoOpenEnabled = true;
            AddonFrame.print("|cff00ff00 Auto open ENABLE", true);
        elseif autoOpenEnabled then
            autoOpenEnabled = false;
            AddonFrame.print("|cffff0000 Auto open DISABLE", true);
        end
    elseif modifier == "RCTRL" then
        local max_count = 0;
        for bag = 1, 2 do
            for slot = 1, GetContainerNumSlots(bag) do
                local item = GetContainerItemLink(bag, slot);
                if item and max_count < 10 then
                    local _,_,quality,_,_,_,_,_,_,_,price = GetItemInfo(item);
                    if quality < 4 and price > 0 then
                        PickupContainerItem(bag, slot);
                        PickupMerchantItem();
                        print("Продано: "..item);
                        max_count = max_count + 1;
                    end
                end
            end
        end
    end
end
]]></Lua>
      <Ability Name="Большой ящик с утилем">
        <SpellID>0</SpellID>
        <Target>None</Target>
        <CancelChannel>false</CancelChannel>
        <CancelCasting>false</CancelCasting>
        <IsUseIncombat>false</IsUseIncombat>
        <IsUsableCheck>true</IsUsableCheck>
        <RecastDelay>0</RecastDelay>
        <RangeCheck>Auto</RangeCheck>
        <IsMovingCheck>NotMoving</IsMovingCheck>
        <Lua><![CDATA[
if autoOpenEnabled then
    -- Продаем только из сумок 1 и 2
    local freeSlots = #GetContainerFreeSlots(2);
    if freeSlots > 3 then
        for _, itemId in ipairs(UTILS_CONTAINER) do
            if not UnitCastingInfo("player") then
                local count = GetItemCount(itemId);
                if (count or 0) > 0 then
                    local start,duration,enable = GetItemCooldown(itemId);
                    if start == 0 and duration == 0 and enable then
                        UseItemByName(itemId);
                    end
                end
            end
        end
    else
        autoOpenEnabled = false;
        AddonFrame.print("|cffff0000 Auto open DISABLE", true);
    end
end
]]></Lua>
      </Ability>
    </Rotation>
  </Profile>
</Profiles>